(function() {
    'use strict';

    angular
    .module('eatChallengeApp',['ngCookies', 'ngCsv','ngMaterial', 'ngSanitize', 'ui.router'])
    .config(routerConfig)
    .config(materialDesignThemer)
    .config(errorDecorator)
    .run(scroller);
    ///////////////////////////////////

    //Show source maps in errors
    errorDecorator.$inject = ['$provide'];
    function errorDecorator($provide) {
        $provide.decorator('$exceptionHandler', decorateError);
        decorateError.$inject = ['$delegate'];
        function decorateError($delegate) {
            return function(exception, cause) {
                $delegate(exception, cause);
                throw exception;
            };
        }
    }

    //Routing enhancements
    scroller.$inject = ['$rootScope'];
    function scroller($rootScope) {
        // scroll to the top on page transition
        $rootScope.$on('$stateChangeSuccess', function() {
            document.body.scrollTop = document.documentElement.scrollTop = 0;
        });

        // Keep track of history
        $rootScope.$on('$stateChangeSuccess', function(ev, to, toParams, from, fromParams) {
            $rootScope.previousState = from.name;
            $rootScope.currentState = to.name;
        });
    }

    //Color themes for buttons
    materialDesignThemer.$inject = ['$mdThemingProvider'];
    function materialDesignThemer($mdThemingProvider) {
        $mdThemingProvider.theme('default').primaryPalette('teal')
                          .backgroundPalette('brown', {'default': '50'})
                          .foregroundPalette[3] = 'rgba(0,0,0,0.67)';
    }

    // UI router
    routerConfig.$inject = ['$stateProvider', '$urlRouterProvider'];
    function routerConfig ($stateProvider, $urlRouterProvider) {

        router($stateProvider, $urlRouterProvider);
        //////////

        function router($stateProvider, $urlRouterProvider) {
            $urlRouterProvider.otherwise('/');

            $stateProvider
            .state('start', {
                url: '/',
                views:{
                    // 'user-controls': {
                    //     templateUrl: '../views/user-controls.html',
                    //     controller: 'userControlsController'
                    // },
                    // 'side-nav': {
                    //     templateUrl: '../views/sideNav.html',
                    //     controller: 'sideNavController'
                    // },
                    'main': {
                        templateUrl: '../views/start.html',
                        controller: 'mainController'
                    }
                }
            })
            .state('children', {
                url: '/children',
                views:{
                    'user-controls': {
                        templateUrl: '../views/user-controls.html',
                        controller: 'userControlsController'
                    },
                    //     'side-nav': {
                    //     templateUrl: '../views/sideNav.html',
                    //     controller: 'sideNavController'
                    // },
                    'main': {
                    templateUrl: '../views/children.html',
                    controller: 'mainController'
                }
                }
            })
            .state('childIncome', {
                url: '/childIncome',
                views:{
                    'user-controls': {
                        templateUrl: '../views/user-controls.html',
                        controller: 'userControlsController'
                    },
                    //     'side-nav': {
                    //     templateUrl: '../views/sideNav.html',
                    //     controller: 'sideNavController'
                    // },
                    'main': {
                    templateUrl: '../views/childIncome.html',
                    controller: 'mainController'
                }
                }
            })
            .state('household', {
                url: '/household',
                views:{
                    'user-controls': {
                        templateUrl: '../views/user-controls.html',
                        controller: 'userControlsController'
                    },
                    // 'side-nav': {
                    //     templateUrl: '../views/sideNav.html',
                    //     controller: 'sideNavController'
                    // },
                    'main': {
                        templateUrl: '../views/household.html',
                        controller: 'mainController'
                    }
                }
            })
            .state('householdIncome', {
                url: '/household-income',
                views:{
                    'user-controls': {
                        templateUrl: '../views/user-controls.html',
                        controller: 'userControlsController'
                    },
                    // 'side-nav': {
                    //     templateUrl: '../views/sideNav.html',
                    //     controller: 'sideNavController'
                    // },
                    'main': {
                        templateUrl: '../views/householdIncome.html',
                        controller: 'householdIncome'
                    }
                }
            })
            .state('disclosure', {
                url: '/disclosure',
                views:{
                    'user-controls': {
                        templateUrl: '../views/user-controls.html',
                        controller: 'userControlsController'
                    },
                    // 'side-nav': {
                    //     templateUrl: '../views/sideNav.html',
                    //     controller: 'sideNavController'
                    // },
                    'main': {
                        templateUrl: '../views/disclosure.html',
                        controller: 'mainController'
                    }
                }
            })
            .state('signature', {
                url: '/signature',
                views:{
                    'user-controls': {
                        templateUrl: '../views/user-controls.html',
                        controller: 'userControlsController'
                    },
                    //     'side-nav': {
                    //     templateUrl: '../views/sideNav.html',
                    //     controller: 'sideNavController'
                    // },
                    'main': {
                    templateUrl: '../views/signature.html',
                    controller: 'mainController'
                }
                }
            })
            .state('confirmation', {
                url: '/confirmation',
                views:{
                    // 'user-controls': {
                    //     templateUrl: '../views/user-controls.html',
                    //     controller: 'userControlsController'
                    // },
                    //     'side-nav': {
                    //     templateUrl: '../views/sideNav.html',
                    //     controller: 'sideNavController'
                    // },
                    'main': {
                    templateUrl: '../views/confirmation.html',
                    controller: 'mainController'
                }
                }
            })
            .state('export', {
                url: '/export',
                views: {
                    // 'user-controls': {
                    //     templateUrl: '../views/user-controls.html',
                    //     controller: 'userControlsController'
                    // },
                    // 'side-nav': {
                    //     templateUrl: '../views/sideNav.html',
                    //     controller: 'sideNavController'
                    // },
                    'main': {
                        templateUrl: '../views/export.html',
                        controller: 'exportController'
                    }
                }
            })
            .state('signup', {
                url: '/signup',
                views:{
                    // 'user-controls': {
                    //     templateUrl: '../views/user-controls.html',
                    //     controller: 'userControlsController'
                    // },
                    // 'side-nav': {
                    //     templateUrl: '../views/sideNav.html',
                    //     controller: 'sideNavController'
                    // },
                    'main': {
                        templateUrl: '../views/signup.html',
                        controller: 'signupController'
                    }
                }

            })
            .state('login', {
                url: '/login',
                views:{
                    // 'user-controls': {
                    //     templateUrl: '../views/user-controls.html',
                    //     controller: 'userControlsController'
                    // },
                    // 'side-nav': {
                    //     templateUrl: '../views/sideNav.html',
                    //     controller: 'sideNavController'
                    // },
                    'main': {
                        templateUrl: '../views/login.html',
                        controller: 'loginController'
                    }
                }
            })
            .state('soFar', {
                url: '/so-far',
                views:{
                    'user-controls': {
                        templateUrl: '../views/user-controls.html',
                        controller: 'userControlsController'
                    },
                    // 'side-nav': {
                    //     templateUrl: '../views/sideNav.html',
                    //     controller: 'sideNavController'
                    // },
                    'main': {
                        templateUrl: '../views/soFar.html',
                        controller: 'soFarController'
                    }
                }
            })
            .state('soFar-2', {
                url: '/so-far-2',
                views:{
                    'user-controls': {
                        templateUrl: '../views/user-controls.html',
                        controller: 'userControlsController'
                    },
                    // 'side-nav': {
                    //     templateUrl: '../views/sideNav.html',
                    //     controller: 'sideNavController'
                    // },
                    'main': {
                        templateUrl: '../views/soFar.html',
                        controller: 'soFarController'
                    }
                }
            })

            .state('saveAndExit', {
                url: '/save-and-exit',
                views:{
                    // 'user-controls': {
                    //     templateUrl: '../views/user-controls.html',
                    //     controller: 'userControlsController'
                    // },
                    //     'side-nav': {
                    //     templateUrl: '../views/sideNav.html',
                    //     controller: 'sideNavController'
                    // },
                    'main': {
                        templateUrl: '../views/save-and-exit.html',
                        controller: 'mainController'
                    }
                }
            });
        }
    }

})();

(function() {
    'use strict';

    angular
        .module('eatChallengeApp')
        .directive('yesNoInput', yesNoInput);

    function yesNoInput () {
        return {
            scope: {
                model: '='
            },
            restrict: 'A',
            replace: true,
            templateUrl: '../views/yesno.html',
        };
    }

})();

(function() {
    'use strict';

    angular
        .module('eatChallengeApp')
        .controller('exportController', exportController);

    exportController.$inject = ['$http', '$scope'];

    function exportController($http, $scope) {
        $http.get('/household/completed').then(function(response) {
            $scope.completedApplications = response.data;
        });
    }

})();

(function() {
    'use strict';

    angular
        .module('eatChallengeApp')
        .controller('householdIncome', householdIncome);

    householdIncome.$inject = [
        '$mdDialog',
        '$mdMedia',
        '$rootScope',
        '$scope',
        '$state',
        'Household',
        'Sections'
    ];

    function householdIncome ($mdDialog, $mdMedia, $rootScope, $scope, $state, Household, Sections, HouseholdIncome) {
        var vm = $scope;
        vm.numberRegex =  '^[1-9][0-9]*$';
        vm.navigateToNextSection = navigateToNextSection;

        var work = {
            categoryName: 'work',
            headline: 'Work Income',
            question: 'earn money through work',
            sources: [
                {
                    value:'work',
                    checkboxLabel: 'Work outside the home in a non-military capacity ',
                    shortLabel: 'Earnings from work',
                    frequency: ['weekly', 'every 2 weeks', 'twice a month', 'monthly'],
                    annotation: 'Please report gross income. This is the amount of income earned before any money is taken out for taxes or deductions. Include salary, wages, and cash bonuses.'
                },
                {
                    value:'selfEmployed',
                    shortLabel: 'Earnings from self employment',
                    checkboxLabel: 'Self-employed',
                    frequency: ['weekly', 'every 2 weeks', 'twice a month', 'monthly'],
                    annotation: 'For household members that are self-employed, report income from that work as a net amount. This is calculated by subtracting the total operating expenses of the business from its gross receipts or revenue.'

                },
                {
                    value:'onStrike',
                    checkboxLabel: 'On strike',
                    shortLabel: 'Strike Benefits',
                    frequency: ['weekly', 'every 2 weeks', '2x month', 'monthly'],
                    // annotation:
                },
                {
                    // TODO: add space for housing allowance per doc
                    value:'military',
                    checkboxLabel: 'In the U.S. military',
                    shortLabel: 'Basic pay and cash bonuses',
                    frequency: ['weekly', 'every 2 weeks', 'twice a month', 'monthly'],
                    annotation: 'Please do not include combat pay, FSSA, or private housing allowances.'
                }
            ]
        };

        var publicAssistance = {
            categoryName: 'publicAssistance',
            headline: 'Public Assistance',
            question: 'receive any public assistance benefits',
            sources:[
                {
                    value:'unemployment',
                    checkboxLabel: 'Unemployment benefits',
                    shortLabel: 'Unemployment benefits',
                    frequency: ['weekly', 'every 2 weeks', 'twice a month', 'monthly'],
                    // annotation: ''
                },
                {
                    value:'workersComp',
                    checkboxLabel: 'Worker’s compensation',
                    shortLabel: 'Worker’s compensation',
                    frequency: ['weekly', 'every 2 weeks', 'twice a month', 'monthly'],
                    // annotation: ''
                },
                {
                    value:'ssi',
                    checkboxLabel: 'Supplemental Security Income (SSI)',
                    shortLabel: 'Supplemental Security Income (SSI)',
                    frequency: ['weekly', 'every 2 weeks', 'twice a month', 'monthly'],
                    // annotation: ''
                },
                {
                    value:'cashAssistance',
                    checkboxLabel: 'Cash assistance from State or local government',
                    shortLabel: 'Cash assistance',
                    frequency: ['weekly', 'every 2 weeks', 'twice a month', 'monthly'],
                    annotation: 'This could include TANF or General Assistance money.'
                },
                {
                    value:'veteransBenefits',
                    checkboxLabel: 'Veteran’s benefits',
                    shortLabel: 'Veteran’s benefits',
                    frequency: ['weekly', 'every 2 weeks', 'twice a month', 'monthly'],
                    // annotation: 'This could include TANF or General Assistance money'
                }
            ]
        };

        var alimony = {
            categoryName: 'alimony',
            headline: 'Alimony',
            question: 'receive alimony payments',
            sources:[
                {
                    value: 'alimony',
                    checkboxLabel: 'alimony payments',
                    shortLabel: 'Alimony payment',
                    frequency: ['weekly', 'every 2 weeks', 'twice a month', 'monthly'],
                    annotation: 'If income is received from alimony, only court-ordered payments should be reported here. Informal but regular payments should be reported later as “other” income.'
                }
            ]
        };

        var childSupport = {
            categoryName: 'childSupport',
            headline: 'Child Support',
            question: 'receive any child support',
            sources: [
                {
                    value: 'childSupport',
                    checkboxLabel: 'any child support',
                    shortLabel: 'Child support payment',
                    frequency: ['weekly', 'every 2 weeks', 'twice a month', 'monthly'],
                    annotation: 'If income is received from child support, only court-ordered payments should be reported here. Informal but regular payments should be reported later as “other” income.'
                }
            ]
        };

        var retirement = {
            categoryName: 'retirement',
            headline: 'Pension and Retirement',
            question: 'receive any pension or retirement money',
            sources: [
                {
                    value: 'socialSecurity',
                    checkboxLabel: 'Social Security',
                    shortLabel: 'Social security',
                    frequency: ['weekly', 'every 2 weeks', 'twice a month', 'monthly'],
                    annotation: 'Please include railroad retirement and black lung benefits'
                },
                {
                    value: 'privatePension',
                    checkboxLabel: 'Private pensions or disability',
                    shortLabel: 'Private pensions or disability',
                    frequency: ['weekly', 'every 2 weeks', 'twice a month', 'monthly'],
                    // annotation: ''
                }
            ]
        };

        var otherIncome = {
            categoryName: 'otherIncome',
            headline: 'Other Income',
            question: 'recieve money through any other source',
            sources: [
                {
                    value: 'trusts',
                    checkboxLabel: 'Income from trusts or estates',
                    shortLabel: 'Income from trusts or estates',
                    frequency: ['weekly', 'every 2 weeks', 'twice a month', 'monthly'],
                    // annotation: ''
                },
                {
                    value: 'annuities',
                    checkboxLabel: 'Annuities',
                    shortLabel: 'Income from annuities',
                    frequency: ['weekly', 'every 2 weeks', 'twice a month', 'monthly'],
                    // annotation: ''
                },
                {
                    value: 'investment',
                    checkboxLabel: 'Investment income',
                    shortLabel: 'Investment income',
                    frequency: ['weekly', 'every 2 weeks', 'twice a month', 'monthly'],
                    // annotation: ''
                },
                {
                    value: 'interest',
                    checkboxLabel: 'Earned interest',
                    shortLabel: 'Earned interest',
                    frequency: ['weekly', 'every 2 weeks', 'twice a month', 'monthly'],
                    // annotation: ''
                },
                {
                    value: 'rentalIncome',
                    checkboxLabel: 'Rental income',
                    shortLabel: 'Rental income',
                    frequency: ['weekly', 'every 2 weeks', 'twice a month', 'monthly'],
                    // annotation: ''
                },
                {
                    value: 'otherCash',
                    checkboxLabel: 'Regular cash payments from outside household',
                    shortLabel: 'Regular cash payments from outside household',
                    frequency: ['weekly', 'every 2 weeks', 'twice a month', 'monthly'],
                    annotation: 'Such cash payments should include regular child support or alimony payments received by the household that are not court-ordered.'
                },
            ]
        };

        function showConfirm(ev) {
            // Appending dialog to document.body to cover sidenav in docs app
            var confirm = $mdDialog.confirm()
                  .title('Ready to go on?')
                  .textContent('It looks like you have some errors or missing information in this section. Do you want to fix it now?')
                  .ariaLabel('Ready to go on?')
                  .targetEvent(ev)
                  .ok('Move Ahead Anyway')
                  .cancel('Go Back and Fix It Now');
            return $mdDialog.show(confirm);
        }

        // TODO: duplicated with main.js. Share in a better way
        function isInvalidForm() {
            var member;

            if (vm.form && (!vm.form.$valid)) {
                return true;
            }

            for (var i = 0; i < $rootScope.household.otherMembers.length ; i++) {
                member = $rootScope.household.otherMembers[i];
                for (var key in member.incomeCategory) {
                    if (member.incomeCategory[key].showCheckboxes === undefined) {
                        return true;
                    }
                }
            }

            return false;
        }

        function fixItHandler() {
            vm.showErrors = true;
            document.body.scrollTop = document.documentElement.scrollTop = 0;
        }

        function moveAheadHandler() {
            Household.save()
            Sections.updateRequiredSections();
            Sections.navigateToNext();
        }

        function navigateToNextSection() {
            if (isInvalidForm()) {
                // open confirmation modal
                showConfirm().then(moveAheadHandler,fixItHandler);
            } else {
                moveAheadHandler();
            }
        }
        vm.goBack = goBack;
        function goBack() {
            Household.save()
            Sections.updateRequiredSections();
            Sections.goBack();
        }

        vm.incomeCategories = [
                                work,
                                publicAssistance,
                                alimony,
                                childSupport,
                                retirement,
                                otherIncome
                              ];

    }

})();

(function() {
    'use strict';

    angular
      .module('eatChallengeApp')
      .controller('loginController', loginController);
    loginController.$inject = ['$scope', '$state', 'auth', 'Household', 'Sections'];
    function loginController($scope, $state, auth, Household, Sections) {
        var vm = $scope;
        var user = {};
        vm.submit = submit;
        vm.user = user;
        //////////////////////

        function submit() {
            // vm.disabled = true;

            auth
            .login(user.email, user.password)
            .then(successHandler, errorHandler);

            function successHandler(response) {
                // vm.disabled = false;
                vm.loginForm = {};
                vm.message = 'successfully logged in';
                $state.go('soFar');
            }

            function errorHandler(response) {
                vm.message = 'Something went wrong. Please try again';
                // vm.disabled = false;
            }

        }
    }

})();

(function() {
    'use strict';

    angular
        .module('eatChallengeApp')
        .controller('mainController', mainController);

    mainController.$inject = [
        '$http',
        '$mdDialog',
        '$mdMedia',
        '$rootScope',
        '$scope',
        '$state',
        '$timeout',
        'Household',
        'Sections'
    ];

    function mainController ($http, $mdDialog, $mdMedia, $rootScope,
                             $scope, $state, $timeout, Household, Sections) {
        /* jshint validthis: true */
        var vm = $scope;
        vm.schoolDistrict = 'Oakland Unified School District';

        // navigation
        vm.goBack = goBack;
        vm.navigateToNextSection = navigateToNextSection;
        vm.submitApplication = submitApplication;
        vm.showErrors = false;
        vm.numberRegex =  '^[1-9][0-9]*$';
        vm.childIncomeSources = {
            work: {
                vaule:'work',
                label: 'Earnings from work:',
                frequency: ['weekly', 'every 2 weeks', 'twice a month', 'monthly'],
                annotation: 'A child has a job where they earn salary or wages. Please report gross income. This is the amount of income earned before any money is taken out for taxes or deductions. Include salary, wages, and cash bonuses.',
            },
            socialSecurity: {
                vaule:'socialSecurity',
                label: 'Social Security Disability Payments or Survivor’s Benefits:',
                frequency: ['monthly'],
                // annotation: 'A child is blind or disabled and receives Social Security benefits.',
                // ' A parent is disabled, retired, or deceased, and their child receives social security benefits',

            },
            otherPerson: {
                vaule:'otherPerson',
                label: 'Income from persons outside the household:',
                frequency: ['weekly', 'every 2 weeks', 'twice a month', 'monthly'],
                annotation: 'A friend or extended family member regularly gives a child spending money.',
            },
            otherSource: {
                vaule:'otherSource',
                label: 'Income from any other source:',
                frequency: ['weekly', 'every 2 weeks', 'twice a month', 'monthly'],
                annotation: 'A child receives income from a private pension fund, annuity, or trust.',
            }
        };
        /////////////////////////////////////

        //New children and household members are created
        //by calling the server to make use of mongoose models
        function addChild(newVal) {
            if (newVal > $rootScope.household.children.length) {
                $http.get('/child').then(function(response) {
                    var newChild = response.data;
                    newChild.incomeSources =  Object.keys(vm.childIncomeSources).map(function(incomeSource) {
                        return {type: incomeSource, amount: null, frequency: null};
                    });
                    $rootScope.household.children.push(newChild);
                    // Recurse if necessary
                    addChild(newVal);
                });
            }
        }

        function addOtherMember(newVal) {
            if (newVal > $rootScope.household.otherMembers.length) {
                $http.get('/household-member').then(function(response) {
                    var newHouseholdMember = response.data;
                    newHouseholdMember = {};
                    $rootScope.household.otherMembers.push(newHouseholdMember);
                    // Recurse if necessary
                    addOtherMember(newVal);
                });
            }
        }

        function trimChildren(household) {
            // get rid of extra empty child obejcets created in process
            if (household.children.length > household.childCount) {
                household.children = household.children.slice(0, household.childCount);
            }
            return household;
        }

        function trimOtherMembers(household) {
            // get rid of extra empty otherMember obejcets created in process
            if (household.otherMembers.length > household.otherMembersCount) {
                household.otherMembers.slice(0, household.otherMembersCount);
            }
            return household;
        }

        function showConfirm(ev) {
            // Appending dialog to document.body to cover sidenav in docs app
            var confirm = $mdDialog.confirm()
                  .title('Ready to go on?')
                  .textContent('It looks like you have some errors or missing information in this section. Do you want to fix it now?')
                  .ariaLabel('Ready to go on?')
                  .targetEvent(ev)
                  .ok('Move Ahead Anyway')
                  .cancel('Go Back and Fix It Now');
            return $mdDialog.show(confirm);
        }

        function goBack() {
            Household.save()
            Sections.updateRequiredSections();
            Sections.goBack();
        }

        //Form Validation
        function isInvalidForm() {
            var child;

            if ($rootScope.currentState === 'childIncome') {
                for (var j = 0; j < $rootScope.household.children.length; j++) {
                    child = $rootScope.household.children[j];
                    if (child.earnsIncome === undefined) {
                        return true;
                    }
                    if (child.earnsIncome === true && !vm.form.$valid) {
                        return true;
                    }
                }

                return false;
            }

            if (vm.form && (!vm.form.$valid)) {
                return true;
            }

            if ($rootScope.currentState === 'children') {
                for (var i = 0; i < $rootScope.household.children.length; i++) {
                    child = $rootScope.household.children[i];
                    if (child.enrolled === undefined) {
                        return true;
                    }
                }
            }

            return false;
        }

        function fixItHandler() {
            vm.showErrors = true;
            document.body.scrollTop = document.documentElement.scrollTop = 0;
        }

        function moveAheadHandler() {
            Household.save();
            Sections.updateRequiredSections();
            Sections.navigateToNext();
        }

        function navigateToNextSection() {
            if (isInvalidForm()) {
                // open confirmation modal
                showConfirm().then(moveAheadHandler,fixItHandler);
            } else {
                moveAheadHandler();
            }
        }

        function submitApplication() {
            trimChildren($rootScope.household);
            trimOtherMembers($rootScope.household);
            $rootScope.household.completed = true;
            if (isInvalidForm()) {
                // open confirmation modal
                showConfirm().then(moveAheadHandler,fixItHandler);
            } else {
                Household.submit();
                Sections.updateRequiredSections();
                Sections.navigateToNext();
            }
        }

        // Watchers
        $scope.$watch('household.childCount', addChild);
        $scope.$watch('household.otherMembersCount', addOtherMember);
    }

})();

(function() {
    'use strict';

    angular
        .module('eatChallengeApp')
        .controller('sideNavController', sideNavController);

    sideNavController.$inject = ['$scope', '$state', 'Sections'];

    function sideNavController ($scope, $state, Sections) {
        /* jshint validthis: true */
        var vm = $scope;

        vm.currentState = $state.$current.self.name;
        vm.sections = Sections.sections;
    }

})();

(function() {
    'use strict';

    angular
      .module('eatChallengeApp')
      .controller('signupController', signupController);
    signupController.$inject = ['$scope', 'auth', 'Sections'];

    function signupController($scope, auth, Sections) {
        var vm = $scope;
        var user = {};
        vm.submit = submit;
        vm.user = user;

        function submit() {
            vm.error = false;
            // TODO: add loading icon to UI when disabled === true
            vm.disabled = true;

            auth.signup(user.email, user.password)
            .then(successHandler, errorHandler);

            function successHandler() {
                vm.disabled = false;
                vm.signupForm = {}; //Reset form
                vm.message = 'successfully created an account';
                Sections.goBack();
            }

            function errorHandler(err) {
                console.log(err);
                vm.error = true;
                vm.message = 'Something went wrong. Please try again';
                vm.disabled = false;
                // vm.signupForm = {}

            }
        }
    }

})();

(function() {
    'use strict';

    angular
        .module('eatChallengeApp')
        .controller('soFarController', soFarController);

    soFarController.$inject = [
        '$http',
        '$interval',
        '$mdDialog',
        '$mdMedia',
        '$rootScope',
        '$scope',
        '$state',
        'Household',
        'Sections'
    ];

    function soFarController ($http, $interval, $mdDialog, $mdMedia, $rootScope,
                             $scope, $state, Household, Sections) {
        /* jshint validthis: true */
        var vm = $scope;
        vm.meansTest = Sections.meansTest;

        vm.childrenLabel = 'children';
        vm.adultsLabel = 'adults';

        vm.incomeEarnersCount = countEarners($rootScope.household);
        vm.incomeEstimate = estimateIncome($rootScope.household);

        // navigation
        vm.goBack = goBack;
        vm.navigateToNextSection = navigateToNextSection;

        /////////////////////////////////////

        function init() {
            if ($rootScope.household.children.length === 1) {
                vm.childrenLabel = 'child';
            }
            if ($rootScope.household.otherMembers.length === 1) {
                vm.adultsLabel = 'adult';
            }
        }

        init();

        function estimateIncome() {
            var frequencyMulitplier = {
                weekly: 52,
                'every 2 weeks': 26,
                'twice a month': 24,
                monthly: 12
            };

            function getTotalforSource(source) {
                return source.amount * frequencyMulitplier[source.frequency];
            }

            var estimatedAnnualIncome = 0;

            $rootScope.household.children.forEach(function(child) {
                if (child.earnsIncome) {
                    child.incomeSources.forEach(function(incomeSource) {
                        if (incomeSource.amount > 0) {
                            estimatedAnnualIncome += getTotalforSource(incomeSource);
                        }
                    });
                }
            });

            $rootScope.household.otherMembers.forEach(function(member) {
                if (!member.incomeCategory) {
                    return;
                }
                var incomeSource;
                for (var key in member.incomeCategory) {
                    // This value gets stashed in the same place
                    incomeSource = member.incomeCategory[key];
                    for (var k in incomeSource) {
                        if (k !== 'showCheckboxes') {
                            var source = incomeSource[k];

                            estimatedAnnualIncome += getTotalforSource(source);
                        }
                    }
                }
            });
            return Math.round(estimatedAnnualIncome);
        }

        function countEarners(household) {
            var earnersCount = 0;
            $rootScope.household.children.forEach(function(child) {
                if (child.earnsIncome) {
                    earnersCount++;
                }
            });

            $rootScope.household.otherMembers.forEach(function(member) {
                if (member.incomeCategory && Object.keys(member.incomeCategory).length > 0) {
                    earnersCount++;
                }
            });

            return earnersCount;
        }

        function goBack() {
            Household.save();
            Sections.updateRequiredSections();
            Sections.goBack();
        }

        function navigateToNextSection() {
            Household.save();
            Sections.updateRequiredSections();
            Sections.navigateToNext();
        }
    }

})();

(function() {
    'use strict';

    angular
      .module('eatChallengeApp')
      .controller('userControlsController', userControlsController);
    userControlsController.$inject = ['$rootScope', '$scope', '$state', 'auth'];
    function userControlsController($rootScope, $scope, $state, auth) {
        var vm = $scope;
        vm.loggedIn = auth.getUserStatus();
        vm.logout = logout;
        vm.user = $rootScope.user;
        /////////////////////////
        function logout() {
            auth.logout();
            vm.loggedIn = auth.getUserStatus();
            $state.go('saveAndExit');
        }

        $rootScope.$watch('user', function() {
            vm.loggedIn = auth.getUserStatus();
            vm.user = $rootScope.user;
        });
    }

})();

(function() {
    'use strict';

    angular
        .module('eatChallengeApp')
        .service('auth', AuthService);

    AuthService.$inject = ['$cookies', '$http', '$q', '$rootScope', '$state', 'Household'];

    function AuthService($cookies, $http, $q, $rootScope, $state, Household) {
        $rootScope.user = null;
        init();
        var service = {};
        service.isLoggedIn = isLoggedIn;
        service.getUserStatus = getUserStatus;
        service.signup = signup;
        service.login = login;
        service.logout = logout;
        service.init = init;

        return service;
        ///////////////////////////
        function init() {
            // Check for user on start
            var user = getCredentials();
            if (user) {
                $rootScope.user = user;
                Household.retrieveForUser(user);
            }

        }

        function isLoggedIn() {
            if ($rootScope.user) {
                return true;
            }
            return false;
        }

        function getUserStatus() {
            return $rootScope.user;
        }

        function signup(email, password) {
            return $http
                .post('/user/signup', {username: email, password: password})
                .then(successHandler, errorHandler);

            function successHandler(response) {
                setCredentials(response.data.user);
                Household.save();
            }

            function errorHandler(err) {
                console.log(err);
            }
        }

        function login(email, password) {
            var data = {
                username: email,
                password: password
            };

            return $http
                .post('/user/login', data)
                .then(successHandler, errorHandler);

            function successHandler(response) {
                setCredentials(response.data.user);
                Household.retrieveForUser(response.data.user);
            }

            function errorHandler(response, err) {
                console.log(err);
                clearCredentials();
            }
        }

        function logout() {
            return $http
                .get('user/logout')
                .then(successHandler, errorHandler);

            function successHandler() {
                clearCredentials();
                Household.clear();
            }

            function errorHandler() {
                clearCredentials();
                Household.clear();
            }
        }

        function setCredentials(user) {
            $rootScope.user = user;
            return $cookies.putObject('user', user);
        }

        function getCredentials() {
            return $cookies.getObject('user');
        }

        function clearCredentials() {
            $rootScope.user = null;
            return $cookies.remove('user');
        }
    }

})();

(function() {
    angular
        .module('eatChallengeApp')
        .service('Household', householdService);

    householdService.$inject = ['$http', '$rootScope'];

    function householdService($http, $rootScope) {
        // Todo: consider moving to server??
        var Household =  {
            childCount: null,
            children: [],
            otherMembersCount: null,
            otherMembers: [],
            completedApplication: false
        };

        $rootScope.household = angular.copy(Household);

        var service = {};
        service.retrieveForUser = retrieveForUser;
        service.save = save;
        service.clear = clear;
        service.submit = submit;

        return service;
        //////////////////////////////////

        function retrieveForUser(user) {
            $http.get('/household/' + user._id)
                .then(function(response) {
                    $rootScope.household = response.data;
                });
        }

        function save() {
            // Only save on the last page or when 
            // there's a signed in user
            if (!$rootScope.user) {
                console.log('did not need to save')
                return;
            }
            $rootScope.household.userId = $rootScope.user._id;
            console.log('before')
            console.log($rootScope.household);
            return $http.post('/household', $rootScope.household)
                    .then(function(response) {
                        console.log('coming back');
                        console.log(response.data);
                        $rootScope.household = response.data;
                    });
        }

        function submit() {
            if ($rootScope.user) {
                $rootScope.household.userId = $rootScope.user._id;
            }

            return $http.post('/household', $rootScope.household);
        }

        function clear () {
            $rootScope.household = Object.create(Household);
        }
    }

})();

(function() {
    'use strict';

    angular
        .module('eatChallengeApp')
        .service('Sections', sectionsService);

    sectionsService.$inject = ['$rootScope' ,'$state'];

    function sectionsService($rootScope, $state) {
        var sections = [
            {
                label: 'Let\’s Get Started! ',
                state: 'start',
                completed: false,
                required: true,
                showSummaryAfter: false
            },            {
                label: 'Children',
                state: 'children',
                completed: false,
                required: true,
                showSummaryAfter: false
            },
            {
                label: 'Household Members',
                state: 'household',
                completed: false,
                required: true,
                showSummaryAfter: false
            },
            {
                label: 'What You\'ve Entered So Far',
                state: 'soFar',
                completed: false,
                required: true,
                showSummaryAfter: false
            },
            {
                label: 'Children\'s Income',
                state: 'childIncome',
                completed: false,
                required: true,
                showSummaryAfter: false
            },
            {
                label: 'Household Income',
                state: 'householdIncome',
                completed: false,
                required: true,
                showSummaryAfter: false
            },
            {
                label: 'Summary',
                state: 'soFar-2',
                completed: false,
                required: true,
                showSummaryAfter: false
            },
            {
                label: 'Disclosure',
                state: 'disclosure',
                completed: false,
                required: true,
                showSummaryAfter: false
            },
            {
                label: 'Sign and Confirm',
                state: 'signature',
                completed: false,
                required: true,
                showSummaryAfter: false
            },
        ];

        var indexedSections = _.indexBy(sections, 'state');

        var service = {
            meansTest: true,
            sections: sections,
            indexedSections: indexedSections,
            navigateToNext: navigateToNext,
            goBack: goBack,
            updateRequiredSections: updateRequiredSections
        };

        return service;
        //////////////////////

        function updateRequiredSections() {
            var household = $rootScope.household;
            service.meansTest = true;
            var assistanceProgramHousehold = isAssistanceHousehold(household);
            var categoricallyQualified = allStudentsCategoricallyQualify(household);

            if (assistanceProgramHousehold || categoricallyQualified) {
                service.meansTest = false;
                indexedSections['childIncome'].required = false;
                indexedSections['household'].required = false;
                indexedSections['householdIncome'].required = false;
                indexedSections['soFar-2'].required = false;
                return;
            }

            sections.forEach(function(section) {
                section.required = true;
            });
        }

        function isAssistanceHousehold(household) {
            var currentChild;
            for (var i = 0 ; i < household.children.length; i++) {
                currentChild = household.children[i];
                if (currentChild.assistanceProgram && currentChild.assistanceProgram.participant) {
                    return true;
                }
            }
            return false;
        }

        function allStudentsCategoricallyQualify(household) {
            var currentChild, childQualifies;

            var enrolledChildren = _.filter(household.children, function(c) {
                return c.enrolled === true;
            });

            // must have kids to qualify
            if (enrolledChildren.length === 0) {
                return false;
            }

            //all children are categorically qualified
            for (var i = 0 ; i < enrolledChildren.length; i++) {
                currentChild = household.children[i];
                if (!currentChild.specialStatus.fosterChild &&
                    !currentChild.specialStatus.homelessMigrantRunaway &&
                    !currentChild.specialStatus.headStartParticipant
                ) {
                    return false;
                }
            }

            return true;

        }

        function findNext(currentState) {
            var currentIndex = _.findIndex(sections, function(section) {
                return section.state === currentState;
            });

            // Look for the next required section
            for (var i = currentIndex + 1; i < sections.length; i++) {
                if (sections[i].required) {
                    return sections[i].state;
                }
            }

            // if there are no more required sections, we're done.
            return 'confirmation';
        }

        function navigateToNext() {
            var nextSection;
            var currentState = $rootScope.currentState || $state.$current.self.name;
            var previousState = $rootScope.previousState || 'start';
                    
            // If you're on some other page like start or signature
            // Move ahead as normal
            nextSection  = findNext(currentState);


            $state.go(nextSection);
        }

        function goBack() {
            var previousState = 'start';
            var currentState = $rootScope.currentState;
            var outOfFlowStates = ['login', 'signup'];

            if (outOfFlowStates.indexOf(currentState) !== -1) {
                previousState = $rootScope.previousState || 'start';
            } else {
                var currentIndex = _.findIndex(sections, function(section) {
                    return section.state === currentState;
                });
                previousState = sections[currentIndex - 1].state;
                while (indexedSections[previousState].required === false) {
                    currentIndex = currentIndex - 1;
                    previousState = sections[currentIndex - 1].state;
                }
            }

            $state.go(previousState);
        }

    }

})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImRpcmVjdGl2ZXMveWVzbm8uanMiLCJjb250cm9sbGVycy9leHBvcnQuanMiLCJjb250cm9sbGVycy9ob3VzZWhvbGRJbmNvbWUuanMiLCJjb250cm9sbGVycy9sb2dpbi5qcyIsImNvbnRyb2xsZXJzL21haW4uanMiLCJjb250cm9sbGVycy9zaWRlbmF2LmpzIiwiY29udHJvbGxlcnMvc2lnbnVwLmpzIiwiY29udHJvbGxlcnMvc29GYXIuanMiLCJjb250cm9sbGVycy91c2VyQ29udHJvbHMuanMiLCJzZXJ2aWNlcy9hdXRoLmpzIiwic2VydmljZXMvaG91c2Vob2xkLmpzIiwic2VydmljZXMvc2VjdGlvbnMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9HQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAubW9kdWxlKCdlYXRDaGFsbGVuZ2VBcHAnLFsnbmdDb29raWVzJywgJ25nQ3N2JywnbmdNYXRlcmlhbCcsICduZ1Nhbml0aXplJywgJ3VpLnJvdXRlciddKVxuICAgIC5jb25maWcocm91dGVyQ29uZmlnKVxuICAgIC5jb25maWcobWF0ZXJpYWxEZXNpZ25UaGVtZXIpXG4gICAgLmNvbmZpZyhlcnJvckRlY29yYXRvcilcbiAgICAucnVuKHNjcm9sbGVyKTtcbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgLy9TaG93IHNvdXJjZSBtYXBzIGluIGVycm9yc1xuICAgIGVycm9yRGVjb3JhdG9yLiRpbmplY3QgPSBbJyRwcm92aWRlJ107XG4gICAgZnVuY3Rpb24gZXJyb3JEZWNvcmF0b3IoJHByb3ZpZGUpIHtcbiAgICAgICAgJHByb3ZpZGUuZGVjb3JhdG9yKCckZXhjZXB0aW9uSGFuZGxlcicsIGRlY29yYXRlRXJyb3IpO1xuICAgICAgICBkZWNvcmF0ZUVycm9yLiRpbmplY3QgPSBbJyRkZWxlZ2F0ZSddO1xuICAgICAgICBmdW5jdGlvbiBkZWNvcmF0ZUVycm9yKCRkZWxlZ2F0ZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGV4Y2VwdGlvbiwgY2F1c2UpIHtcbiAgICAgICAgICAgICAgICAkZGVsZWdhdGUoZXhjZXB0aW9uLCBjYXVzZSk7XG4gICAgICAgICAgICAgICAgdGhyb3cgZXhjZXB0aW9uO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vUm91dGluZyBlbmhhbmNlbWVudHNcbiAgICBzY3JvbGxlci4kaW5qZWN0ID0gWyckcm9vdFNjb3BlJ107XG4gICAgZnVuY3Rpb24gc2Nyb2xsZXIoJHJvb3RTY29wZSkge1xuICAgICAgICAvLyBzY3JvbGwgdG8gdGhlIHRvcCBvbiBwYWdlIHRyYW5zaXRpb25cbiAgICAgICAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZVN1Y2Nlc3MnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCA9IDA7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEtlZXAgdHJhY2sgb2YgaGlzdG9yeVxuICAgICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3VjY2VzcycsIGZ1bmN0aW9uKGV2LCB0bywgdG9QYXJhbXMsIGZyb20sIGZyb21QYXJhbXMpIHtcbiAgICAgICAgICAgICRyb290U2NvcGUucHJldmlvdXNTdGF0ZSA9IGZyb20ubmFtZTtcbiAgICAgICAgICAgICRyb290U2NvcGUuY3VycmVudFN0YXRlID0gdG8ubmFtZTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy9Db2xvciB0aGVtZXMgZm9yIGJ1dHRvbnNcbiAgICBtYXRlcmlhbERlc2lnblRoZW1lci4kaW5qZWN0ID0gWyckbWRUaGVtaW5nUHJvdmlkZXInXTtcbiAgICBmdW5jdGlvbiBtYXRlcmlhbERlc2lnblRoZW1lcigkbWRUaGVtaW5nUHJvdmlkZXIpIHtcbiAgICAgICAgJG1kVGhlbWluZ1Byb3ZpZGVyLnRoZW1lKCdkZWZhdWx0JykucHJpbWFyeVBhbGV0dGUoJ3RlYWwnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAuYmFja2dyb3VuZFBhbGV0dGUoJ2Jyb3duJywgeydkZWZhdWx0JzogJzUwJ30pXG4gICAgICAgICAgICAgICAgICAgICAgICAgIC5mb3JlZ3JvdW5kUGFsZXR0ZVszXSA9ICdyZ2JhKDAsMCwwLDAuNjcpJztcbiAgICB9XG5cbiAgICAvLyBVSSByb3V0ZXJcbiAgICByb3V0ZXJDb25maWcuJGluamVjdCA9IFsnJHN0YXRlUHJvdmlkZXInLCAnJHVybFJvdXRlclByb3ZpZGVyJ107XG4gICAgZnVuY3Rpb24gcm91dGVyQ29uZmlnICgkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XG5cbiAgICAgICAgcm91dGVyKCRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpO1xuICAgICAgICAvLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gcm91dGVyKCRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcbiAgICAgICAgICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy8nKTtcblxuICAgICAgICAgICAgJHN0YXRlUHJvdmlkZXJcbiAgICAgICAgICAgIC5zdGF0ZSgnc3RhcnQnLCB7XG4gICAgICAgICAgICAgICAgdXJsOiAnLycsXG4gICAgICAgICAgICAgICAgdmlld3M6e1xuICAgICAgICAgICAgICAgICAgICAvLyAndXNlci1jb250cm9scyc6IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIHRlbXBsYXRlVXJsOiAnLi4vdmlld3MvdXNlci1jb250cm9scy5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIGNvbnRyb2xsZXI6ICd1c2VyQ29udHJvbHNDb250cm9sbGVyJ1xuICAgICAgICAgICAgICAgICAgICAvLyB9LFxuICAgICAgICAgICAgICAgICAgICAvLyAnc2lkZS1uYXYnOiB7XG4gICAgICAgICAgICAgICAgICAgIC8vICAgICB0ZW1wbGF0ZVVybDogJy4uL3ZpZXdzL3NpZGVOYXYuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICBjb250cm9sbGVyOiAnc2lkZU5hdkNvbnRyb2xsZXInXG4gICAgICAgICAgICAgICAgICAgIC8vIH0sXG4gICAgICAgICAgICAgICAgICAgICdtYWluJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcuLi92aWV3cy9zdGFydC5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdtYWluQ29udHJvbGxlcidcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuc3RhdGUoJ2NoaWxkcmVuJywge1xuICAgICAgICAgICAgICAgIHVybDogJy9jaGlsZHJlbicsXG4gICAgICAgICAgICAgICAgdmlld3M6e1xuICAgICAgICAgICAgICAgICAgICAndXNlci1jb250cm9scyc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnLi4vdmlld3MvdXNlci1jb250cm9scy5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICd1c2VyQ29udHJvbHNDb250cm9sbGVyJ1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgJ3NpZGUtbmF2Jzoge1xuICAgICAgICAgICAgICAgICAgICAvLyAgICAgdGVtcGxhdGVVcmw6ICcuLi92aWV3cy9zaWRlTmF2Lmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgY29udHJvbGxlcjogJ3NpZGVOYXZDb250cm9sbGVyJ1xuICAgICAgICAgICAgICAgICAgICAvLyB9LFxuICAgICAgICAgICAgICAgICAgICAnbWFpbic6IHtcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcuLi92aWV3cy9jaGlsZHJlbi5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ21haW5Db250cm9sbGVyJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnN0YXRlKCdjaGlsZEluY29tZScsIHtcbiAgICAgICAgICAgICAgICB1cmw6ICcvY2hpbGRJbmNvbWUnLFxuICAgICAgICAgICAgICAgIHZpZXdzOntcbiAgICAgICAgICAgICAgICAgICAgJ3VzZXItY29udHJvbHMnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy4uL3ZpZXdzL3VzZXItY29udHJvbHMuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAndXNlckNvbnRyb2xzQ29udHJvbGxlcidcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgICdzaWRlLW5hdic6IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIHRlbXBsYXRlVXJsOiAnLi4vdmlld3Mvc2lkZU5hdi5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIGNvbnRyb2xsZXI6ICdzaWRlTmF2Q29udHJvbGxlcidcbiAgICAgICAgICAgICAgICAgICAgLy8gfSxcbiAgICAgICAgICAgICAgICAgICAgJ21haW4nOiB7XG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnLi4vdmlld3MvY2hpbGRJbmNvbWUuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdtYWluQ29udHJvbGxlcidcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5zdGF0ZSgnaG91c2Vob2xkJywge1xuICAgICAgICAgICAgICAgIHVybDogJy9ob3VzZWhvbGQnLFxuICAgICAgICAgICAgICAgIHZpZXdzOntcbiAgICAgICAgICAgICAgICAgICAgJ3VzZXItY29udHJvbHMnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy4uL3ZpZXdzL3VzZXItY29udHJvbHMuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAndXNlckNvbnRyb2xzQ29udHJvbGxlcidcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgLy8gJ3NpZGUtbmF2Jzoge1xuICAgICAgICAgICAgICAgICAgICAvLyAgICAgdGVtcGxhdGVVcmw6ICcuLi92aWV3cy9zaWRlTmF2Lmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgY29udHJvbGxlcjogJ3NpZGVOYXZDb250cm9sbGVyJ1xuICAgICAgICAgICAgICAgICAgICAvLyB9LFxuICAgICAgICAgICAgICAgICAgICAnbWFpbic6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnLi4vdmlld3MvaG91c2Vob2xkLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ21haW5Db250cm9sbGVyJ1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5zdGF0ZSgnaG91c2Vob2xkSW5jb21lJywge1xuICAgICAgICAgICAgICAgIHVybDogJy9ob3VzZWhvbGQtaW5jb21lJyxcbiAgICAgICAgICAgICAgICB2aWV3czp7XG4gICAgICAgICAgICAgICAgICAgICd1c2VyLWNvbnRyb2xzJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcuLi92aWV3cy91c2VyLWNvbnRyb2xzLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ3VzZXJDb250cm9sc0NvbnRyb2xsZXInXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIC8vICdzaWRlLW5hdic6IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIHRlbXBsYXRlVXJsOiAnLi4vdmlld3Mvc2lkZU5hdi5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIGNvbnRyb2xsZXI6ICdzaWRlTmF2Q29udHJvbGxlcidcbiAgICAgICAgICAgICAgICAgICAgLy8gfSxcbiAgICAgICAgICAgICAgICAgICAgJ21haW4nOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy4uL3ZpZXdzL2hvdXNlaG9sZEluY29tZS5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdob3VzZWhvbGRJbmNvbWUnXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnN0YXRlKCdkaXNjbG9zdXJlJywge1xuICAgICAgICAgICAgICAgIHVybDogJy9kaXNjbG9zdXJlJyxcbiAgICAgICAgICAgICAgICB2aWV3czp7XG4gICAgICAgICAgICAgICAgICAgICd1c2VyLWNvbnRyb2xzJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcuLi92aWV3cy91c2VyLWNvbnRyb2xzLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ3VzZXJDb250cm9sc0NvbnRyb2xsZXInXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIC8vICdzaWRlLW5hdic6IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIHRlbXBsYXRlVXJsOiAnLi4vdmlld3Mvc2lkZU5hdi5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIGNvbnRyb2xsZXI6ICdzaWRlTmF2Q29udHJvbGxlcidcbiAgICAgICAgICAgICAgICAgICAgLy8gfSxcbiAgICAgICAgICAgICAgICAgICAgJ21haW4nOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy4uL3ZpZXdzL2Rpc2Nsb3N1cmUuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnbWFpbkNvbnRyb2xsZXInXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnN0YXRlKCdzaWduYXR1cmUnLCB7XG4gICAgICAgICAgICAgICAgdXJsOiAnL3NpZ25hdHVyZScsXG4gICAgICAgICAgICAgICAgdmlld3M6e1xuICAgICAgICAgICAgICAgICAgICAndXNlci1jb250cm9scyc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnLi4vdmlld3MvdXNlci1jb250cm9scy5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICd1c2VyQ29udHJvbHNDb250cm9sbGVyJ1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgJ3NpZGUtbmF2Jzoge1xuICAgICAgICAgICAgICAgICAgICAvLyAgICAgdGVtcGxhdGVVcmw6ICcuLi92aWV3cy9zaWRlTmF2Lmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgY29udHJvbGxlcjogJ3NpZGVOYXZDb250cm9sbGVyJ1xuICAgICAgICAgICAgICAgICAgICAvLyB9LFxuICAgICAgICAgICAgICAgICAgICAnbWFpbic6IHtcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcuLi92aWV3cy9zaWduYXR1cmUuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdtYWluQ29udHJvbGxlcidcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5zdGF0ZSgnY29uZmlybWF0aW9uJywge1xuICAgICAgICAgICAgICAgIHVybDogJy9jb25maXJtYXRpb24nLFxuICAgICAgICAgICAgICAgIHZpZXdzOntcbiAgICAgICAgICAgICAgICAgICAgLy8gJ3VzZXItY29udHJvbHMnOiB7XG4gICAgICAgICAgICAgICAgICAgIC8vICAgICB0ZW1wbGF0ZVVybDogJy4uL3ZpZXdzL3VzZXItY29udHJvbHMuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICBjb250cm9sbGVyOiAndXNlckNvbnRyb2xzQ29udHJvbGxlcidcbiAgICAgICAgICAgICAgICAgICAgLy8gfSxcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgICdzaWRlLW5hdic6IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIHRlbXBsYXRlVXJsOiAnLi4vdmlld3Mvc2lkZU5hdi5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIGNvbnRyb2xsZXI6ICdzaWRlTmF2Q29udHJvbGxlcidcbiAgICAgICAgICAgICAgICAgICAgLy8gfSxcbiAgICAgICAgICAgICAgICAgICAgJ21haW4nOiB7XG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnLi4vdmlld3MvY29uZmlybWF0aW9uLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnbWFpbkNvbnRyb2xsZXInXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuc3RhdGUoJ2V4cG9ydCcsIHtcbiAgICAgICAgICAgICAgICB1cmw6ICcvZXhwb3J0JyxcbiAgICAgICAgICAgICAgICB2aWV3czoge1xuICAgICAgICAgICAgICAgICAgICAvLyAndXNlci1jb250cm9scyc6IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIHRlbXBsYXRlVXJsOiAnLi4vdmlld3MvdXNlci1jb250cm9scy5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIGNvbnRyb2xsZXI6ICd1c2VyQ29udHJvbHNDb250cm9sbGVyJ1xuICAgICAgICAgICAgICAgICAgICAvLyB9LFxuICAgICAgICAgICAgICAgICAgICAvLyAnc2lkZS1uYXYnOiB7XG4gICAgICAgICAgICAgICAgICAgIC8vICAgICB0ZW1wbGF0ZVVybDogJy4uL3ZpZXdzL3NpZGVOYXYuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICBjb250cm9sbGVyOiAnc2lkZU5hdkNvbnRyb2xsZXInXG4gICAgICAgICAgICAgICAgICAgIC8vIH0sXG4gICAgICAgICAgICAgICAgICAgICdtYWluJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcuLi92aWV3cy9leHBvcnQuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnZXhwb3J0Q29udHJvbGxlcidcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuc3RhdGUoJ3NpZ251cCcsIHtcbiAgICAgICAgICAgICAgICB1cmw6ICcvc2lnbnVwJyxcbiAgICAgICAgICAgICAgICB2aWV3czp7XG4gICAgICAgICAgICAgICAgICAgIC8vICd1c2VyLWNvbnRyb2xzJzoge1xuICAgICAgICAgICAgICAgICAgICAvLyAgICAgdGVtcGxhdGVVcmw6ICcuLi92aWV3cy91c2VyLWNvbnRyb2xzLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgY29udHJvbGxlcjogJ3VzZXJDb250cm9sc0NvbnRyb2xsZXInXG4gICAgICAgICAgICAgICAgICAgIC8vIH0sXG4gICAgICAgICAgICAgICAgICAgIC8vICdzaWRlLW5hdic6IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIHRlbXBsYXRlVXJsOiAnLi4vdmlld3Mvc2lkZU5hdi5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIGNvbnRyb2xsZXI6ICdzaWRlTmF2Q29udHJvbGxlcidcbiAgICAgICAgICAgICAgICAgICAgLy8gfSxcbiAgICAgICAgICAgICAgICAgICAgJ21haW4nOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy4uL3ZpZXdzL3NpZ251cC5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdzaWdudXBDb250cm9sbGVyJ1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnN0YXRlKCdsb2dpbicsIHtcbiAgICAgICAgICAgICAgICB1cmw6ICcvbG9naW4nLFxuICAgICAgICAgICAgICAgIHZpZXdzOntcbiAgICAgICAgICAgICAgICAgICAgLy8gJ3VzZXItY29udHJvbHMnOiB7XG4gICAgICAgICAgICAgICAgICAgIC8vICAgICB0ZW1wbGF0ZVVybDogJy4uL3ZpZXdzL3VzZXItY29udHJvbHMuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICBjb250cm9sbGVyOiAndXNlckNvbnRyb2xzQ29udHJvbGxlcidcbiAgICAgICAgICAgICAgICAgICAgLy8gfSxcbiAgICAgICAgICAgICAgICAgICAgLy8gJ3NpZGUtbmF2Jzoge1xuICAgICAgICAgICAgICAgICAgICAvLyAgICAgdGVtcGxhdGVVcmw6ICcuLi92aWV3cy9zaWRlTmF2Lmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgY29udHJvbGxlcjogJ3NpZGVOYXZDb250cm9sbGVyJ1xuICAgICAgICAgICAgICAgICAgICAvLyB9LFxuICAgICAgICAgICAgICAgICAgICAnbWFpbic6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnLi4vdmlld3MvbG9naW4uaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnbG9naW5Db250cm9sbGVyJ1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5zdGF0ZSgnc29GYXInLCB7XG4gICAgICAgICAgICAgICAgdXJsOiAnL3NvLWZhcicsXG4gICAgICAgICAgICAgICAgdmlld3M6e1xuICAgICAgICAgICAgICAgICAgICAndXNlci1jb250cm9scyc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnLi4vdmlld3MvdXNlci1jb250cm9scy5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICd1c2VyQ29udHJvbHNDb250cm9sbGVyJ1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAvLyAnc2lkZS1uYXYnOiB7XG4gICAgICAgICAgICAgICAgICAgIC8vICAgICB0ZW1wbGF0ZVVybDogJy4uL3ZpZXdzL3NpZGVOYXYuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICBjb250cm9sbGVyOiAnc2lkZU5hdkNvbnRyb2xsZXInXG4gICAgICAgICAgICAgICAgICAgIC8vIH0sXG4gICAgICAgICAgICAgICAgICAgICdtYWluJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcuLi92aWV3cy9zb0Zhci5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdzb0ZhckNvbnRyb2xsZXInXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnN0YXRlKCdzb0Zhci0yJywge1xuICAgICAgICAgICAgICAgIHVybDogJy9zby1mYXItMicsXG4gICAgICAgICAgICAgICAgdmlld3M6e1xuICAgICAgICAgICAgICAgICAgICAndXNlci1jb250cm9scyc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnLi4vdmlld3MvdXNlci1jb250cm9scy5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICd1c2VyQ29udHJvbHNDb250cm9sbGVyJ1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAvLyAnc2lkZS1uYXYnOiB7XG4gICAgICAgICAgICAgICAgICAgIC8vICAgICB0ZW1wbGF0ZVVybDogJy4uL3ZpZXdzL3NpZGVOYXYuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICBjb250cm9sbGVyOiAnc2lkZU5hdkNvbnRyb2xsZXInXG4gICAgICAgICAgICAgICAgICAgIC8vIH0sXG4gICAgICAgICAgICAgICAgICAgICdtYWluJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcuLi92aWV3cy9zb0Zhci5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdzb0ZhckNvbnRyb2xsZXInXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAuc3RhdGUoJ3NhdmVBbmRFeGl0Jywge1xuICAgICAgICAgICAgICAgIHVybDogJy9zYXZlLWFuZC1leGl0JyxcbiAgICAgICAgICAgICAgICB2aWV3czp7XG4gICAgICAgICAgICAgICAgICAgIC8vICd1c2VyLWNvbnRyb2xzJzoge1xuICAgICAgICAgICAgICAgICAgICAvLyAgICAgdGVtcGxhdGVVcmw6ICcuLi92aWV3cy91c2VyLWNvbnRyb2xzLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgY29udHJvbGxlcjogJ3VzZXJDb250cm9sc0NvbnRyb2xsZXInXG4gICAgICAgICAgICAgICAgICAgIC8vIH0sXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICAnc2lkZS1uYXYnOiB7XG4gICAgICAgICAgICAgICAgICAgIC8vICAgICB0ZW1wbGF0ZVVybDogJy4uL3ZpZXdzL3NpZGVOYXYuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICBjb250cm9sbGVyOiAnc2lkZU5hdkNvbnRyb2xsZXInXG4gICAgICAgICAgICAgICAgICAgIC8vIH0sXG4gICAgICAgICAgICAgICAgICAgICdtYWluJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcuLi92aWV3cy9zYXZlLWFuZC1leGl0Lmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ21haW5Db250cm9sbGVyJ1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdlYXRDaGFsbGVuZ2VBcHAnKVxuICAgICAgICAuZGlyZWN0aXZlKCd5ZXNOb0lucHV0JywgeWVzTm9JbnB1dCk7XG5cbiAgICBmdW5jdGlvbiB5ZXNOb0lucHV0ICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgbW9kZWw6ICc9J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcuLi92aWV3cy95ZXNuby5odG1sJyxcbiAgICAgICAgfTtcbiAgICB9XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdlYXRDaGFsbGVuZ2VBcHAnKVxuICAgICAgICAuY29udHJvbGxlcignZXhwb3J0Q29udHJvbGxlcicsIGV4cG9ydENvbnRyb2xsZXIpO1xuXG4gICAgZXhwb3J0Q29udHJvbGxlci4kaW5qZWN0ID0gWyckaHR0cCcsICckc2NvcGUnXTtcblxuICAgIGZ1bmN0aW9uIGV4cG9ydENvbnRyb2xsZXIoJGh0dHAsICRzY29wZSkge1xuICAgICAgICAkaHR0cC5nZXQoJy9ob3VzZWhvbGQvY29tcGxldGVkJykudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgJHNjb3BlLmNvbXBsZXRlZEFwcGxpY2F0aW9ucyA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgIH0pO1xuICAgIH1cblxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2VhdENoYWxsZW5nZUFwcCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdob3VzZWhvbGRJbmNvbWUnLCBob3VzZWhvbGRJbmNvbWUpO1xuXG4gICAgaG91c2Vob2xkSW5jb21lLiRpbmplY3QgPSBbXG4gICAgICAgICckbWREaWFsb2cnLFxuICAgICAgICAnJG1kTWVkaWEnLFxuICAgICAgICAnJHJvb3RTY29wZScsXG4gICAgICAgICckc2NvcGUnLFxuICAgICAgICAnJHN0YXRlJyxcbiAgICAgICAgJ0hvdXNlaG9sZCcsXG4gICAgICAgICdTZWN0aW9ucydcbiAgICBdO1xuXG4gICAgZnVuY3Rpb24gaG91c2Vob2xkSW5jb21lICgkbWREaWFsb2csICRtZE1lZGlhLCAkcm9vdFNjb3BlLCAkc2NvcGUsICRzdGF0ZSwgSG91c2Vob2xkLCBTZWN0aW9ucywgSG91c2Vob2xkSW5jb21lKSB7XG4gICAgICAgIHZhciB2bSA9ICRzY29wZTtcbiAgICAgICAgdm0ubnVtYmVyUmVnZXggPSAgJ15bMS05XVswLTldKiQnO1xuICAgICAgICB2bS5uYXZpZ2F0ZVRvTmV4dFNlY3Rpb24gPSBuYXZpZ2F0ZVRvTmV4dFNlY3Rpb247XG5cbiAgICAgICAgdmFyIHdvcmsgPSB7XG4gICAgICAgICAgICBjYXRlZ29yeU5hbWU6ICd3b3JrJyxcbiAgICAgICAgICAgIGhlYWRsaW5lOiAnV29yayBJbmNvbWUnLFxuICAgICAgICAgICAgcXVlc3Rpb246ICdlYXJuIG1vbmV5IHRocm91Z2ggd29yaycsXG4gICAgICAgICAgICBzb3VyY2VzOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTond29yaycsXG4gICAgICAgICAgICAgICAgICAgIGNoZWNrYm94TGFiZWw6ICdXb3JrIG91dHNpZGUgdGhlIGhvbWUgaW4gYSBub24tbWlsaXRhcnkgY2FwYWNpdHkgJyxcbiAgICAgICAgICAgICAgICAgICAgc2hvcnRMYWJlbDogJ0Vhcm5pbmdzIGZyb20gd29yaycsXG4gICAgICAgICAgICAgICAgICAgIGZyZXF1ZW5jeTogWyd3ZWVrbHknLCAnZXZlcnkgMiB3ZWVrcycsICd0d2ljZSBhIG1vbnRoJywgJ21vbnRobHknXSxcbiAgICAgICAgICAgICAgICAgICAgYW5ub3RhdGlvbjogJ1BsZWFzZSByZXBvcnQgZ3Jvc3MgaW5jb21lLiBUaGlzIGlzIHRoZSBhbW91bnQgb2YgaW5jb21lIGVhcm5lZCBiZWZvcmUgYW55IG1vbmV5IGlzIHRha2VuIG91dCBmb3IgdGF4ZXMgb3IgZGVkdWN0aW9ucy4gSW5jbHVkZSBzYWxhcnksIHdhZ2VzLCBhbmQgY2FzaCBib251c2VzLidcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6J3NlbGZFbXBsb3llZCcsXG4gICAgICAgICAgICAgICAgICAgIHNob3J0TGFiZWw6ICdFYXJuaW5ncyBmcm9tIHNlbGYgZW1wbG95bWVudCcsXG4gICAgICAgICAgICAgICAgICAgIGNoZWNrYm94TGFiZWw6ICdTZWxmLWVtcGxveWVkJyxcbiAgICAgICAgICAgICAgICAgICAgZnJlcXVlbmN5OiBbJ3dlZWtseScsICdldmVyeSAyIHdlZWtzJywgJ3R3aWNlIGEgbW9udGgnLCAnbW9udGhseSddLFxuICAgICAgICAgICAgICAgICAgICBhbm5vdGF0aW9uOiAnRm9yIGhvdXNlaG9sZCBtZW1iZXJzIHRoYXQgYXJlIHNlbGYtZW1wbG95ZWQsIHJlcG9ydCBpbmNvbWUgZnJvbSB0aGF0IHdvcmsgYXMgYSBuZXQgYW1vdW50LiBUaGlzIGlzIGNhbGN1bGF0ZWQgYnkgc3VidHJhY3RpbmcgdGhlIHRvdGFsIG9wZXJhdGluZyBleHBlbnNlcyBvZiB0aGUgYnVzaW5lc3MgZnJvbSBpdHMgZ3Jvc3MgcmVjZWlwdHMgb3IgcmV2ZW51ZS4nXG5cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6J29uU3RyaWtlJyxcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tib3hMYWJlbDogJ09uIHN0cmlrZScsXG4gICAgICAgICAgICAgICAgICAgIHNob3J0TGFiZWw6ICdTdHJpa2UgQmVuZWZpdHMnLFxuICAgICAgICAgICAgICAgICAgICBmcmVxdWVuY3k6IFsnd2Vla2x5JywgJ2V2ZXJ5IDIgd2Vla3MnLCAnMnggbW9udGgnLCAnbW9udGhseSddLFxuICAgICAgICAgICAgICAgICAgICAvLyBhbm5vdGF0aW9uOlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBhZGQgc3BhY2UgZm9yIGhvdXNpbmcgYWxsb3dhbmNlIHBlciBkb2NcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6J21pbGl0YXJ5JyxcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tib3hMYWJlbDogJ0luIHRoZSBVLlMuIG1pbGl0YXJ5JyxcbiAgICAgICAgICAgICAgICAgICAgc2hvcnRMYWJlbDogJ0Jhc2ljIHBheSBhbmQgY2FzaCBib251c2VzJyxcbiAgICAgICAgICAgICAgICAgICAgZnJlcXVlbmN5OiBbJ3dlZWtseScsICdldmVyeSAyIHdlZWtzJywgJ3R3aWNlIGEgbW9udGgnLCAnbW9udGhseSddLFxuICAgICAgICAgICAgICAgICAgICBhbm5vdGF0aW9uOiAnUGxlYXNlIGRvIG5vdCBpbmNsdWRlIGNvbWJhdCBwYXksIEZTU0EsIG9yIHByaXZhdGUgaG91c2luZyBhbGxvd2FuY2VzLidcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBdXG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHB1YmxpY0Fzc2lzdGFuY2UgPSB7XG4gICAgICAgICAgICBjYXRlZ29yeU5hbWU6ICdwdWJsaWNBc3Npc3RhbmNlJyxcbiAgICAgICAgICAgIGhlYWRsaW5lOiAnUHVibGljIEFzc2lzdGFuY2UnLFxuICAgICAgICAgICAgcXVlc3Rpb246ICdyZWNlaXZlIGFueSBwdWJsaWMgYXNzaXN0YW5jZSBiZW5lZml0cycsXG4gICAgICAgICAgICBzb3VyY2VzOltcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOid1bmVtcGxveW1lbnQnLFxuICAgICAgICAgICAgICAgICAgICBjaGVja2JveExhYmVsOiAnVW5lbXBsb3ltZW50IGJlbmVmaXRzJyxcbiAgICAgICAgICAgICAgICAgICAgc2hvcnRMYWJlbDogJ1VuZW1wbG95bWVudCBiZW5lZml0cycsXG4gICAgICAgICAgICAgICAgICAgIGZyZXF1ZW5jeTogWyd3ZWVrbHknLCAnZXZlcnkgMiB3ZWVrcycsICd0d2ljZSBhIG1vbnRoJywgJ21vbnRobHknXSxcbiAgICAgICAgICAgICAgICAgICAgLy8gYW5ub3RhdGlvbjogJydcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6J3dvcmtlcnNDb21wJyxcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tib3hMYWJlbDogJ1dvcmtlcuKAmXMgY29tcGVuc2F0aW9uJyxcbiAgICAgICAgICAgICAgICAgICAgc2hvcnRMYWJlbDogJ1dvcmtlcuKAmXMgY29tcGVuc2F0aW9uJyxcbiAgICAgICAgICAgICAgICAgICAgZnJlcXVlbmN5OiBbJ3dlZWtseScsICdldmVyeSAyIHdlZWtzJywgJ3R3aWNlIGEgbW9udGgnLCAnbW9udGhseSddLFxuICAgICAgICAgICAgICAgICAgICAvLyBhbm5vdGF0aW9uOiAnJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTonc3NpJyxcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tib3hMYWJlbDogJ1N1cHBsZW1lbnRhbCBTZWN1cml0eSBJbmNvbWUgKFNTSSknLFxuICAgICAgICAgICAgICAgICAgICBzaG9ydExhYmVsOiAnU3VwcGxlbWVudGFsIFNlY3VyaXR5IEluY29tZSAoU1NJKScsXG4gICAgICAgICAgICAgICAgICAgIGZyZXF1ZW5jeTogWyd3ZWVrbHknLCAnZXZlcnkgMiB3ZWVrcycsICd0d2ljZSBhIG1vbnRoJywgJ21vbnRobHknXSxcbiAgICAgICAgICAgICAgICAgICAgLy8gYW5ub3RhdGlvbjogJydcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6J2Nhc2hBc3Npc3RhbmNlJyxcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tib3hMYWJlbDogJ0Nhc2ggYXNzaXN0YW5jZSBmcm9tIFN0YXRlIG9yIGxvY2FsIGdvdmVybm1lbnQnLFxuICAgICAgICAgICAgICAgICAgICBzaG9ydExhYmVsOiAnQ2FzaCBhc3Npc3RhbmNlJyxcbiAgICAgICAgICAgICAgICAgICAgZnJlcXVlbmN5OiBbJ3dlZWtseScsICdldmVyeSAyIHdlZWtzJywgJ3R3aWNlIGEgbW9udGgnLCAnbW9udGhseSddLFxuICAgICAgICAgICAgICAgICAgICBhbm5vdGF0aW9uOiAnVGhpcyBjb3VsZCBpbmNsdWRlIFRBTkYgb3IgR2VuZXJhbCBBc3Npc3RhbmNlIG1vbmV5LidcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6J3ZldGVyYW5zQmVuZWZpdHMnLFxuICAgICAgICAgICAgICAgICAgICBjaGVja2JveExhYmVsOiAnVmV0ZXJhbuKAmXMgYmVuZWZpdHMnLFxuICAgICAgICAgICAgICAgICAgICBzaG9ydExhYmVsOiAnVmV0ZXJhbuKAmXMgYmVuZWZpdHMnLFxuICAgICAgICAgICAgICAgICAgICBmcmVxdWVuY3k6IFsnd2Vla2x5JywgJ2V2ZXJ5IDIgd2Vla3MnLCAndHdpY2UgYSBtb250aCcsICdtb250aGx5J10sXG4gICAgICAgICAgICAgICAgICAgIC8vIGFubm90YXRpb246ICdUaGlzIGNvdWxkIGluY2x1ZGUgVEFORiBvciBHZW5lcmFsIEFzc2lzdGFuY2UgbW9uZXknXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBhbGltb255ID0ge1xuICAgICAgICAgICAgY2F0ZWdvcnlOYW1lOiAnYWxpbW9ueScsXG4gICAgICAgICAgICBoZWFkbGluZTogJ0FsaW1vbnknLFxuICAgICAgICAgICAgcXVlc3Rpb246ICdyZWNlaXZlIGFsaW1vbnkgcGF5bWVudHMnLFxuICAgICAgICAgICAgc291cmNlczpbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJ2FsaW1vbnknLFxuICAgICAgICAgICAgICAgICAgICBjaGVja2JveExhYmVsOiAnYWxpbW9ueSBwYXltZW50cycsXG4gICAgICAgICAgICAgICAgICAgIHNob3J0TGFiZWw6ICdBbGltb255IHBheW1lbnQnLFxuICAgICAgICAgICAgICAgICAgICBmcmVxdWVuY3k6IFsnd2Vla2x5JywgJ2V2ZXJ5IDIgd2Vla3MnLCAndHdpY2UgYSBtb250aCcsICdtb250aGx5J10sXG4gICAgICAgICAgICAgICAgICAgIGFubm90YXRpb246ICdJZiBpbmNvbWUgaXMgcmVjZWl2ZWQgZnJvbSBhbGltb255LCBvbmx5IGNvdXJ0LW9yZGVyZWQgcGF5bWVudHMgc2hvdWxkIGJlIHJlcG9ydGVkIGhlcmUuIEluZm9ybWFsIGJ1dCByZWd1bGFyIHBheW1lbnRzIHNob3VsZCBiZSByZXBvcnRlZCBsYXRlciBhcyDigJxvdGhlcuKAnSBpbmNvbWUuJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgY2hpbGRTdXBwb3J0ID0ge1xuICAgICAgICAgICAgY2F0ZWdvcnlOYW1lOiAnY2hpbGRTdXBwb3J0JyxcbiAgICAgICAgICAgIGhlYWRsaW5lOiAnQ2hpbGQgU3VwcG9ydCcsXG4gICAgICAgICAgICBxdWVzdGlvbjogJ3JlY2VpdmUgYW55IGNoaWxkIHN1cHBvcnQnLFxuICAgICAgICAgICAgc291cmNlczogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICdjaGlsZFN1cHBvcnQnLFxuICAgICAgICAgICAgICAgICAgICBjaGVja2JveExhYmVsOiAnYW55IGNoaWxkIHN1cHBvcnQnLFxuICAgICAgICAgICAgICAgICAgICBzaG9ydExhYmVsOiAnQ2hpbGQgc3VwcG9ydCBwYXltZW50JyxcbiAgICAgICAgICAgICAgICAgICAgZnJlcXVlbmN5OiBbJ3dlZWtseScsICdldmVyeSAyIHdlZWtzJywgJ3R3aWNlIGEgbW9udGgnLCAnbW9udGhseSddLFxuICAgICAgICAgICAgICAgICAgICBhbm5vdGF0aW9uOiAnSWYgaW5jb21lIGlzIHJlY2VpdmVkIGZyb20gY2hpbGQgc3VwcG9ydCwgb25seSBjb3VydC1vcmRlcmVkIHBheW1lbnRzIHNob3VsZCBiZSByZXBvcnRlZCBoZXJlLiBJbmZvcm1hbCBidXQgcmVndWxhciBwYXltZW50cyBzaG91bGQgYmUgcmVwb3J0ZWQgbGF0ZXIgYXMg4oCcb3RoZXLigJ0gaW5jb21lLidcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBdXG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHJldGlyZW1lbnQgPSB7XG4gICAgICAgICAgICBjYXRlZ29yeU5hbWU6ICdyZXRpcmVtZW50JyxcbiAgICAgICAgICAgIGhlYWRsaW5lOiAnUGVuc2lvbiBhbmQgUmV0aXJlbWVudCcsXG4gICAgICAgICAgICBxdWVzdGlvbjogJ3JlY2VpdmUgYW55IHBlbnNpb24gb3IgcmV0aXJlbWVudCBtb25leScsXG4gICAgICAgICAgICBzb3VyY2VzOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJ3NvY2lhbFNlY3VyaXR5JyxcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tib3hMYWJlbDogJ1NvY2lhbCBTZWN1cml0eScsXG4gICAgICAgICAgICAgICAgICAgIHNob3J0TGFiZWw6ICdTb2NpYWwgc2VjdXJpdHknLFxuICAgICAgICAgICAgICAgICAgICBmcmVxdWVuY3k6IFsnd2Vla2x5JywgJ2V2ZXJ5IDIgd2Vla3MnLCAndHdpY2UgYSBtb250aCcsICdtb250aGx5J10sXG4gICAgICAgICAgICAgICAgICAgIGFubm90YXRpb246ICdQbGVhc2UgaW5jbHVkZSByYWlscm9hZCByZXRpcmVtZW50IGFuZCBibGFjayBsdW5nIGJlbmVmaXRzJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJ3ByaXZhdGVQZW5zaW9uJyxcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tib3hMYWJlbDogJ1ByaXZhdGUgcGVuc2lvbnMgb3IgZGlzYWJpbGl0eScsXG4gICAgICAgICAgICAgICAgICAgIHNob3J0TGFiZWw6ICdQcml2YXRlIHBlbnNpb25zIG9yIGRpc2FiaWxpdHknLFxuICAgICAgICAgICAgICAgICAgICBmcmVxdWVuY3k6IFsnd2Vla2x5JywgJ2V2ZXJ5IDIgd2Vla3MnLCAndHdpY2UgYSBtb250aCcsICdtb250aGx5J10sXG4gICAgICAgICAgICAgICAgICAgIC8vIGFubm90YXRpb246ICcnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBvdGhlckluY29tZSA9IHtcbiAgICAgICAgICAgIGNhdGVnb3J5TmFtZTogJ290aGVySW5jb21lJyxcbiAgICAgICAgICAgIGhlYWRsaW5lOiAnT3RoZXIgSW5jb21lJyxcbiAgICAgICAgICAgIHF1ZXN0aW9uOiAncmVjaWV2ZSBtb25leSB0aHJvdWdoIGFueSBvdGhlciBzb3VyY2UnLFxuICAgICAgICAgICAgc291cmNlczogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICd0cnVzdHMnLFxuICAgICAgICAgICAgICAgICAgICBjaGVja2JveExhYmVsOiAnSW5jb21lIGZyb20gdHJ1c3RzIG9yIGVzdGF0ZXMnLFxuICAgICAgICAgICAgICAgICAgICBzaG9ydExhYmVsOiAnSW5jb21lIGZyb20gdHJ1c3RzIG9yIGVzdGF0ZXMnLFxuICAgICAgICAgICAgICAgICAgICBmcmVxdWVuY3k6IFsnd2Vla2x5JywgJ2V2ZXJ5IDIgd2Vla3MnLCAndHdpY2UgYSBtb250aCcsICdtb250aGx5J10sXG4gICAgICAgICAgICAgICAgICAgIC8vIGFubm90YXRpb246ICcnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnYW5udWl0aWVzJyxcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tib3hMYWJlbDogJ0FubnVpdGllcycsXG4gICAgICAgICAgICAgICAgICAgIHNob3J0TGFiZWw6ICdJbmNvbWUgZnJvbSBhbm51aXRpZXMnLFxuICAgICAgICAgICAgICAgICAgICBmcmVxdWVuY3k6IFsnd2Vla2x5JywgJ2V2ZXJ5IDIgd2Vla3MnLCAndHdpY2UgYSBtb250aCcsICdtb250aGx5J10sXG4gICAgICAgICAgICAgICAgICAgIC8vIGFubm90YXRpb246ICcnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnaW52ZXN0bWVudCcsXG4gICAgICAgICAgICAgICAgICAgIGNoZWNrYm94TGFiZWw6ICdJbnZlc3RtZW50IGluY29tZScsXG4gICAgICAgICAgICAgICAgICAgIHNob3J0TGFiZWw6ICdJbnZlc3RtZW50IGluY29tZScsXG4gICAgICAgICAgICAgICAgICAgIGZyZXF1ZW5jeTogWyd3ZWVrbHknLCAnZXZlcnkgMiB3ZWVrcycsICd0d2ljZSBhIG1vbnRoJywgJ21vbnRobHknXSxcbiAgICAgICAgICAgICAgICAgICAgLy8gYW5ub3RhdGlvbjogJydcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICdpbnRlcmVzdCcsXG4gICAgICAgICAgICAgICAgICAgIGNoZWNrYm94TGFiZWw6ICdFYXJuZWQgaW50ZXJlc3QnLFxuICAgICAgICAgICAgICAgICAgICBzaG9ydExhYmVsOiAnRWFybmVkIGludGVyZXN0JyxcbiAgICAgICAgICAgICAgICAgICAgZnJlcXVlbmN5OiBbJ3dlZWtseScsICdldmVyeSAyIHdlZWtzJywgJ3R3aWNlIGEgbW9udGgnLCAnbW9udGhseSddLFxuICAgICAgICAgICAgICAgICAgICAvLyBhbm5vdGF0aW9uOiAnJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJ3JlbnRhbEluY29tZScsXG4gICAgICAgICAgICAgICAgICAgIGNoZWNrYm94TGFiZWw6ICdSZW50YWwgaW5jb21lJyxcbiAgICAgICAgICAgICAgICAgICAgc2hvcnRMYWJlbDogJ1JlbnRhbCBpbmNvbWUnLFxuICAgICAgICAgICAgICAgICAgICBmcmVxdWVuY3k6IFsnd2Vla2x5JywgJ2V2ZXJ5IDIgd2Vla3MnLCAndHdpY2UgYSBtb250aCcsICdtb250aGx5J10sXG4gICAgICAgICAgICAgICAgICAgIC8vIGFubm90YXRpb246ICcnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnb3RoZXJDYXNoJyxcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tib3hMYWJlbDogJ1JlZ3VsYXIgY2FzaCBwYXltZW50cyBmcm9tIG91dHNpZGUgaG91c2Vob2xkJyxcbiAgICAgICAgICAgICAgICAgICAgc2hvcnRMYWJlbDogJ1JlZ3VsYXIgY2FzaCBwYXltZW50cyBmcm9tIG91dHNpZGUgaG91c2Vob2xkJyxcbiAgICAgICAgICAgICAgICAgICAgZnJlcXVlbmN5OiBbJ3dlZWtseScsICdldmVyeSAyIHdlZWtzJywgJ3R3aWNlIGEgbW9udGgnLCAnbW9udGhseSddLFxuICAgICAgICAgICAgICAgICAgICBhbm5vdGF0aW9uOiAnU3VjaCBjYXNoIHBheW1lbnRzIHNob3VsZCBpbmNsdWRlIHJlZ3VsYXIgY2hpbGQgc3VwcG9ydCBvciBhbGltb255IHBheW1lbnRzIHJlY2VpdmVkIGJ5IHRoZSBob3VzZWhvbGQgdGhhdCBhcmUgbm90IGNvdXJ0LW9yZGVyZWQuJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdXG4gICAgICAgIH07XG5cbiAgICAgICAgZnVuY3Rpb24gc2hvd0NvbmZpcm0oZXYpIHtcbiAgICAgICAgICAgIC8vIEFwcGVuZGluZyBkaWFsb2cgdG8gZG9jdW1lbnQuYm9keSB0byBjb3ZlciBzaWRlbmF2IGluIGRvY3MgYXBwXG4gICAgICAgICAgICB2YXIgY29uZmlybSA9ICRtZERpYWxvZy5jb25maXJtKClcbiAgICAgICAgICAgICAgICAgIC50aXRsZSgnUmVhZHkgdG8gZ28gb24/JylcbiAgICAgICAgICAgICAgICAgIC50ZXh0Q29udGVudCgnSXQgbG9va3MgbGlrZSB5b3UgaGF2ZSBzb21lIGVycm9ycyBvciBtaXNzaW5nIGluZm9ybWF0aW9uIGluIHRoaXMgc2VjdGlvbi4gRG8geW91IHdhbnQgdG8gZml4IGl0IG5vdz8nKVxuICAgICAgICAgICAgICAgICAgLmFyaWFMYWJlbCgnUmVhZHkgdG8gZ28gb24/JylcbiAgICAgICAgICAgICAgICAgIC50YXJnZXRFdmVudChldilcbiAgICAgICAgICAgICAgICAgIC5vaygnTW92ZSBBaGVhZCBBbnl3YXknKVxuICAgICAgICAgICAgICAgICAgLmNhbmNlbCgnR28gQmFjayBhbmQgRml4IEl0IE5vdycpO1xuICAgICAgICAgICAgcmV0dXJuICRtZERpYWxvZy5zaG93KGNvbmZpcm0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVE9ETzogZHVwbGljYXRlZCB3aXRoIG1haW4uanMuIFNoYXJlIGluIGEgYmV0dGVyIHdheVxuICAgICAgICBmdW5jdGlvbiBpc0ludmFsaWRGb3JtKCkge1xuICAgICAgICAgICAgdmFyIG1lbWJlcjtcblxuICAgICAgICAgICAgaWYgKHZtLmZvcm0gJiYgKCF2bS5mb3JtLiR2YWxpZCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAkcm9vdFNjb3BlLmhvdXNlaG9sZC5vdGhlck1lbWJlcnMubGVuZ3RoIDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbWVtYmVyID0gJHJvb3RTY29wZS5ob3VzZWhvbGQub3RoZXJNZW1iZXJzW2ldO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBtZW1iZXIuaW5jb21lQ2F0ZWdvcnkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lbWJlci5pbmNvbWVDYXRlZ29yeVtrZXldLnNob3dDaGVja2JveGVzID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBmaXhJdEhhbmRsZXIoKSB7XG4gICAgICAgICAgICB2bS5zaG93RXJyb3JzID0gdHJ1ZTtcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCA9IDA7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBtb3ZlQWhlYWRIYW5kbGVyKCkge1xuICAgICAgICAgICAgSG91c2Vob2xkLnNhdmUoKVxuICAgICAgICAgICAgU2VjdGlvbnMudXBkYXRlUmVxdWlyZWRTZWN0aW9ucygpO1xuICAgICAgICAgICAgU2VjdGlvbnMubmF2aWdhdGVUb05leHQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIG5hdmlnYXRlVG9OZXh0U2VjdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChpc0ludmFsaWRGb3JtKCkpIHtcbiAgICAgICAgICAgICAgICAvLyBvcGVuIGNvbmZpcm1hdGlvbiBtb2RhbFxuICAgICAgICAgICAgICAgIHNob3dDb25maXJtKCkudGhlbihtb3ZlQWhlYWRIYW5kbGVyLGZpeEl0SGFuZGxlcik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG1vdmVBaGVhZEhhbmRsZXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB2bS5nb0JhY2sgPSBnb0JhY2s7XG4gICAgICAgIGZ1bmN0aW9uIGdvQmFjaygpIHtcbiAgICAgICAgICAgIEhvdXNlaG9sZC5zYXZlKClcbiAgICAgICAgICAgIFNlY3Rpb25zLnVwZGF0ZVJlcXVpcmVkU2VjdGlvbnMoKTtcbiAgICAgICAgICAgIFNlY3Rpb25zLmdvQmFjaygpO1xuICAgICAgICB9XG5cbiAgICAgICAgdm0uaW5jb21lQ2F0ZWdvcmllcyA9IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd29yayxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljQXNzaXN0YW5jZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxpbW9ueSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRTdXBwb3J0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRpcmVtZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdGhlckluY29tZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXTtcblxuICAgIH1cblxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAubW9kdWxlKCdlYXRDaGFsbGVuZ2VBcHAnKVxuICAgICAgLmNvbnRyb2xsZXIoJ2xvZ2luQ29udHJvbGxlcicsIGxvZ2luQ29udHJvbGxlcik7XG4gICAgbG9naW5Db250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICckc3RhdGUnLCAnYXV0aCcsICdIb3VzZWhvbGQnLCAnU2VjdGlvbnMnXTtcbiAgICBmdW5jdGlvbiBsb2dpbkNvbnRyb2xsZXIoJHNjb3BlLCAkc3RhdGUsIGF1dGgsIEhvdXNlaG9sZCwgU2VjdGlvbnMpIHtcbiAgICAgICAgdmFyIHZtID0gJHNjb3BlO1xuICAgICAgICB2YXIgdXNlciA9IHt9O1xuICAgICAgICB2bS5zdWJtaXQgPSBzdWJtaXQ7XG4gICAgICAgIHZtLnVzZXIgPSB1c2VyO1xuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gc3VibWl0KCkge1xuICAgICAgICAgICAgLy8gdm0uZGlzYWJsZWQgPSB0cnVlO1xuXG4gICAgICAgICAgICBhdXRoXG4gICAgICAgICAgICAubG9naW4odXNlci5lbWFpbCwgdXNlci5wYXNzd29yZClcbiAgICAgICAgICAgIC50aGVuKHN1Y2Nlc3NIYW5kbGVyLCBlcnJvckhhbmRsZXIpO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBzdWNjZXNzSGFuZGxlcihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIC8vIHZtLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdm0ubG9naW5Gb3JtID0ge307XG4gICAgICAgICAgICAgICAgdm0ubWVzc2FnZSA9ICdzdWNjZXNzZnVsbHkgbG9nZ2VkIGluJztcbiAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3NvRmFyJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGVycm9ySGFuZGxlcihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSAnU29tZXRoaW5nIHdlbnQgd3JvbmcuIFBsZWFzZSB0cnkgYWdhaW4nO1xuICAgICAgICAgICAgICAgIC8vIHZtLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuICAgIH1cblxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2VhdENoYWxsZW5nZUFwcCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdtYWluQ29udHJvbGxlcicsIG1haW5Db250cm9sbGVyKTtcblxuICAgIG1haW5Db250cm9sbGVyLiRpbmplY3QgPSBbXG4gICAgICAgICckaHR0cCcsXG4gICAgICAgICckbWREaWFsb2cnLFxuICAgICAgICAnJG1kTWVkaWEnLFxuICAgICAgICAnJHJvb3RTY29wZScsXG4gICAgICAgICckc2NvcGUnLFxuICAgICAgICAnJHN0YXRlJyxcbiAgICAgICAgJyR0aW1lb3V0JyxcbiAgICAgICAgJ0hvdXNlaG9sZCcsXG4gICAgICAgICdTZWN0aW9ucydcbiAgICBdO1xuXG4gICAgZnVuY3Rpb24gbWFpbkNvbnRyb2xsZXIgKCRodHRwLCAkbWREaWFsb2csICRtZE1lZGlhLCAkcm9vdFNjb3BlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUsICRzdGF0ZSwgJHRpbWVvdXQsIEhvdXNlaG9sZCwgU2VjdGlvbnMpIHtcbiAgICAgICAgLyoganNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xuICAgICAgICB2YXIgdm0gPSAkc2NvcGU7XG4gICAgICAgIHZtLnNjaG9vbERpc3RyaWN0ID0gJ09ha2xhbmQgVW5pZmllZCBTY2hvb2wgRGlzdHJpY3QnO1xuXG4gICAgICAgIC8vIG5hdmlnYXRpb25cbiAgICAgICAgdm0uZ29CYWNrID0gZ29CYWNrO1xuICAgICAgICB2bS5uYXZpZ2F0ZVRvTmV4dFNlY3Rpb24gPSBuYXZpZ2F0ZVRvTmV4dFNlY3Rpb247XG4gICAgICAgIHZtLnN1Ym1pdEFwcGxpY2F0aW9uID0gc3VibWl0QXBwbGljYXRpb247XG4gICAgICAgIHZtLnNob3dFcnJvcnMgPSBmYWxzZTtcbiAgICAgICAgdm0ubnVtYmVyUmVnZXggPSAgJ15bMS05XVswLTldKiQnO1xuICAgICAgICB2bS5jaGlsZEluY29tZVNvdXJjZXMgPSB7XG4gICAgICAgICAgICB3b3JrOiB7XG4gICAgICAgICAgICAgICAgdmF1bGU6J3dvcmsnLFxuICAgICAgICAgICAgICAgIGxhYmVsOiAnRWFybmluZ3MgZnJvbSB3b3JrOicsXG4gICAgICAgICAgICAgICAgZnJlcXVlbmN5OiBbJ3dlZWtseScsICdldmVyeSAyIHdlZWtzJywgJ3R3aWNlIGEgbW9udGgnLCAnbW9udGhseSddLFxuICAgICAgICAgICAgICAgIGFubm90YXRpb246ICdBIGNoaWxkIGhhcyBhIGpvYiB3aGVyZSB0aGV5IGVhcm4gc2FsYXJ5IG9yIHdhZ2VzLiBQbGVhc2UgcmVwb3J0IGdyb3NzIGluY29tZS4gVGhpcyBpcyB0aGUgYW1vdW50IG9mIGluY29tZSBlYXJuZWQgYmVmb3JlIGFueSBtb25leSBpcyB0YWtlbiBvdXQgZm9yIHRheGVzIG9yIGRlZHVjdGlvbnMuIEluY2x1ZGUgc2FsYXJ5LCB3YWdlcywgYW5kIGNhc2ggYm9udXNlcy4nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNvY2lhbFNlY3VyaXR5OiB7XG4gICAgICAgICAgICAgICAgdmF1bGU6J3NvY2lhbFNlY3VyaXR5JyxcbiAgICAgICAgICAgICAgICBsYWJlbDogJ1NvY2lhbCBTZWN1cml0eSBEaXNhYmlsaXR5IFBheW1lbnRzIG9yIFN1cnZpdm9y4oCZcyBCZW5lZml0czonLFxuICAgICAgICAgICAgICAgIGZyZXF1ZW5jeTogWydtb250aGx5J10sXG4gICAgICAgICAgICAgICAgLy8gYW5ub3RhdGlvbjogJ0EgY2hpbGQgaXMgYmxpbmQgb3IgZGlzYWJsZWQgYW5kIHJlY2VpdmVzIFNvY2lhbCBTZWN1cml0eSBiZW5lZml0cy4nLFxuICAgICAgICAgICAgICAgIC8vICcgQSBwYXJlbnQgaXMgZGlzYWJsZWQsIHJldGlyZWQsIG9yIGRlY2Vhc2VkLCBhbmQgdGhlaXIgY2hpbGQgcmVjZWl2ZXMgc29jaWFsIHNlY3VyaXR5IGJlbmVmaXRzJyxcblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG90aGVyUGVyc29uOiB7XG4gICAgICAgICAgICAgICAgdmF1bGU6J290aGVyUGVyc29uJyxcbiAgICAgICAgICAgICAgICBsYWJlbDogJ0luY29tZSBmcm9tIHBlcnNvbnMgb3V0c2lkZSB0aGUgaG91c2Vob2xkOicsXG4gICAgICAgICAgICAgICAgZnJlcXVlbmN5OiBbJ3dlZWtseScsICdldmVyeSAyIHdlZWtzJywgJ3R3aWNlIGEgbW9udGgnLCAnbW9udGhseSddLFxuICAgICAgICAgICAgICAgIGFubm90YXRpb246ICdBIGZyaWVuZCBvciBleHRlbmRlZCBmYW1pbHkgbWVtYmVyIHJlZ3VsYXJseSBnaXZlcyBhIGNoaWxkIHNwZW5kaW5nIG1vbmV5LicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb3RoZXJTb3VyY2U6IHtcbiAgICAgICAgICAgICAgICB2YXVsZTonb3RoZXJTb3VyY2UnLFxuICAgICAgICAgICAgICAgIGxhYmVsOiAnSW5jb21lIGZyb20gYW55IG90aGVyIHNvdXJjZTonLFxuICAgICAgICAgICAgICAgIGZyZXF1ZW5jeTogWyd3ZWVrbHknLCAnZXZlcnkgMiB3ZWVrcycsICd0d2ljZSBhIG1vbnRoJywgJ21vbnRobHknXSxcbiAgICAgICAgICAgICAgICBhbm5vdGF0aW9uOiAnQSBjaGlsZCByZWNlaXZlcyBpbmNvbWUgZnJvbSBhIHByaXZhdGUgcGVuc2lvbiBmdW5kLCBhbm51aXR5LCBvciB0cnVzdC4nLFxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgLy9OZXcgY2hpbGRyZW4gYW5kIGhvdXNlaG9sZCBtZW1iZXJzIGFyZSBjcmVhdGVkXG4gICAgICAgIC8vYnkgY2FsbGluZyB0aGUgc2VydmVyIHRvIG1ha2UgdXNlIG9mIG1vbmdvb3NlIG1vZGVsc1xuICAgICAgICBmdW5jdGlvbiBhZGRDaGlsZChuZXdWYWwpIHtcbiAgICAgICAgICAgIGlmIChuZXdWYWwgPiAkcm9vdFNjb3BlLmhvdXNlaG9sZC5jaGlsZHJlbi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9jaGlsZCcpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0NoaWxkID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgbmV3Q2hpbGQuaW5jb21lU291cmNlcyA9ICBPYmplY3Qua2V5cyh2bS5jaGlsZEluY29tZVNvdXJjZXMpLm1hcChmdW5jdGlvbihpbmNvbWVTb3VyY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7dHlwZTogaW5jb21lU291cmNlLCBhbW91bnQ6IG51bGwsIGZyZXF1ZW5jeTogbnVsbH07XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmhvdXNlaG9sZC5jaGlsZHJlbi5wdXNoKG5ld0NoaWxkKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gUmVjdXJzZSBpZiBuZWNlc3NhcnlcbiAgICAgICAgICAgICAgICAgICAgYWRkQ2hpbGQobmV3VmFsKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGFkZE90aGVyTWVtYmVyKG5ld1ZhbCkge1xuICAgICAgICAgICAgaWYgKG5ld1ZhbCA+ICRyb290U2NvcGUuaG91c2Vob2xkLm90aGVyTWVtYmVycy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9ob3VzZWhvbGQtbWVtYmVyJykudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbmV3SG91c2Vob2xkTWVtYmVyID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgbmV3SG91c2Vob2xkTWVtYmVyID0ge307XG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuaG91c2Vob2xkLm90aGVyTWVtYmVycy5wdXNoKG5ld0hvdXNlaG9sZE1lbWJlcik7XG4gICAgICAgICAgICAgICAgICAgIC8vIFJlY3Vyc2UgaWYgbmVjZXNzYXJ5XG4gICAgICAgICAgICAgICAgICAgIGFkZE90aGVyTWVtYmVyKG5ld1ZhbCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiB0cmltQ2hpbGRyZW4oaG91c2Vob2xkKSB7XG4gICAgICAgICAgICAvLyBnZXQgcmlkIG9mIGV4dHJhIGVtcHR5IGNoaWxkIG9iZWpjZXRzIGNyZWF0ZWQgaW4gcHJvY2Vzc1xuICAgICAgICAgICAgaWYgKGhvdXNlaG9sZC5jaGlsZHJlbi5sZW5ndGggPiBob3VzZWhvbGQuY2hpbGRDb3VudCkge1xuICAgICAgICAgICAgICAgIGhvdXNlaG9sZC5jaGlsZHJlbiA9IGhvdXNlaG9sZC5jaGlsZHJlbi5zbGljZSgwLCBob3VzZWhvbGQuY2hpbGRDb3VudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gaG91c2Vob2xkO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gdHJpbU90aGVyTWVtYmVycyhob3VzZWhvbGQpIHtcbiAgICAgICAgICAgIC8vIGdldCByaWQgb2YgZXh0cmEgZW1wdHkgb3RoZXJNZW1iZXIgb2JlamNldHMgY3JlYXRlZCBpbiBwcm9jZXNzXG4gICAgICAgICAgICBpZiAoaG91c2Vob2xkLm90aGVyTWVtYmVycy5sZW5ndGggPiBob3VzZWhvbGQub3RoZXJNZW1iZXJzQ291bnQpIHtcbiAgICAgICAgICAgICAgICBob3VzZWhvbGQub3RoZXJNZW1iZXJzLnNsaWNlKDAsIGhvdXNlaG9sZC5vdGhlck1lbWJlcnNDb3VudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gaG91c2Vob2xkO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc2hvd0NvbmZpcm0oZXYpIHtcbiAgICAgICAgICAgIC8vIEFwcGVuZGluZyBkaWFsb2cgdG8gZG9jdW1lbnQuYm9keSB0byBjb3ZlciBzaWRlbmF2IGluIGRvY3MgYXBwXG4gICAgICAgICAgICB2YXIgY29uZmlybSA9ICRtZERpYWxvZy5jb25maXJtKClcbiAgICAgICAgICAgICAgICAgIC50aXRsZSgnUmVhZHkgdG8gZ28gb24/JylcbiAgICAgICAgICAgICAgICAgIC50ZXh0Q29udGVudCgnSXQgbG9va3MgbGlrZSB5b3UgaGF2ZSBzb21lIGVycm9ycyBvciBtaXNzaW5nIGluZm9ybWF0aW9uIGluIHRoaXMgc2VjdGlvbi4gRG8geW91IHdhbnQgdG8gZml4IGl0IG5vdz8nKVxuICAgICAgICAgICAgICAgICAgLmFyaWFMYWJlbCgnUmVhZHkgdG8gZ28gb24/JylcbiAgICAgICAgICAgICAgICAgIC50YXJnZXRFdmVudChldilcbiAgICAgICAgICAgICAgICAgIC5vaygnTW92ZSBBaGVhZCBBbnl3YXknKVxuICAgICAgICAgICAgICAgICAgLmNhbmNlbCgnR28gQmFjayBhbmQgRml4IEl0IE5vdycpO1xuICAgICAgICAgICAgcmV0dXJuICRtZERpYWxvZy5zaG93KGNvbmZpcm0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ29CYWNrKCkge1xuICAgICAgICAgICAgSG91c2Vob2xkLnNhdmUoKVxuICAgICAgICAgICAgU2VjdGlvbnMudXBkYXRlUmVxdWlyZWRTZWN0aW9ucygpO1xuICAgICAgICAgICAgU2VjdGlvbnMuZ29CYWNrKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL0Zvcm0gVmFsaWRhdGlvblxuICAgICAgICBmdW5jdGlvbiBpc0ludmFsaWRGb3JtKCkge1xuICAgICAgICAgICAgdmFyIGNoaWxkO1xuXG4gICAgICAgICAgICBpZiAoJHJvb3RTY29wZS5jdXJyZW50U3RhdGUgPT09ICdjaGlsZEluY29tZScpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8ICRyb290U2NvcGUuaG91c2Vob2xkLmNoaWxkcmVuLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNoaWxkID0gJHJvb3RTY29wZS5ob3VzZWhvbGQuY2hpbGRyZW5bal07XG4gICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZC5lYXJuc0luY29tZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQuZWFybnNJbmNvbWUgPT09IHRydWUgJiYgIXZtLmZvcm0uJHZhbGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHZtLmZvcm0gJiYgKCF2bS5mb3JtLiR2YWxpZCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCRyb290U2NvcGUuY3VycmVudFN0YXRlID09PSAnY2hpbGRyZW4nKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAkcm9vdFNjb3BlLmhvdXNlaG9sZC5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBjaGlsZCA9ICRyb290U2NvcGUuaG91c2Vob2xkLmNoaWxkcmVuW2ldO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQuZW5yb2xsZWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGZpeEl0SGFuZGxlcigpIHtcbiAgICAgICAgICAgIHZtLnNob3dFcnJvcnMgPSB0cnVlO1xuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wID0gMDtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIG1vdmVBaGVhZEhhbmRsZXIoKSB7XG4gICAgICAgICAgICBIb3VzZWhvbGQuc2F2ZSgpO1xuICAgICAgICAgICAgU2VjdGlvbnMudXBkYXRlUmVxdWlyZWRTZWN0aW9ucygpO1xuICAgICAgICAgICAgU2VjdGlvbnMubmF2aWdhdGVUb05leHQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIG5hdmlnYXRlVG9OZXh0U2VjdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChpc0ludmFsaWRGb3JtKCkpIHtcbiAgICAgICAgICAgICAgICAvLyBvcGVuIGNvbmZpcm1hdGlvbiBtb2RhbFxuICAgICAgICAgICAgICAgIHNob3dDb25maXJtKCkudGhlbihtb3ZlQWhlYWRIYW5kbGVyLGZpeEl0SGFuZGxlcik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG1vdmVBaGVhZEhhbmRsZXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHN1Ym1pdEFwcGxpY2F0aW9uKCkge1xuICAgICAgICAgICAgdHJpbUNoaWxkcmVuKCRyb290U2NvcGUuaG91c2Vob2xkKTtcbiAgICAgICAgICAgIHRyaW1PdGhlck1lbWJlcnMoJHJvb3RTY29wZS5ob3VzZWhvbGQpO1xuICAgICAgICAgICAgJHJvb3RTY29wZS5ob3VzZWhvbGQuY29tcGxldGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmIChpc0ludmFsaWRGb3JtKCkpIHtcbiAgICAgICAgICAgICAgICAvLyBvcGVuIGNvbmZpcm1hdGlvbiBtb2RhbFxuICAgICAgICAgICAgICAgIHNob3dDb25maXJtKCkudGhlbihtb3ZlQWhlYWRIYW5kbGVyLGZpeEl0SGFuZGxlcik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIEhvdXNlaG9sZC5zdWJtaXQoKTtcbiAgICAgICAgICAgICAgICBTZWN0aW9ucy51cGRhdGVSZXF1aXJlZFNlY3Rpb25zKCk7XG4gICAgICAgICAgICAgICAgU2VjdGlvbnMubmF2aWdhdGVUb05leHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFdhdGNoZXJzXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ2hvdXNlaG9sZC5jaGlsZENvdW50JywgYWRkQ2hpbGQpO1xuICAgICAgICAkc2NvcGUuJHdhdGNoKCdob3VzZWhvbGQub3RoZXJNZW1iZXJzQ291bnQnLCBhZGRPdGhlck1lbWJlcik7XG4gICAgfVxuXG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnZWF0Q2hhbGxlbmdlQXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ3NpZGVOYXZDb250cm9sbGVyJywgc2lkZU5hdkNvbnRyb2xsZXIpO1xuXG4gICAgc2lkZU5hdkNvbnRyb2xsZXIuJGluamVjdCA9IFsnJHNjb3BlJywgJyRzdGF0ZScsICdTZWN0aW9ucyddO1xuXG4gICAgZnVuY3Rpb24gc2lkZU5hdkNvbnRyb2xsZXIgKCRzY29wZSwgJHN0YXRlLCBTZWN0aW9ucykge1xuICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOiB0cnVlICovXG4gICAgICAgIHZhciB2bSA9ICRzY29wZTtcblxuICAgICAgICB2bS5jdXJyZW50U3RhdGUgPSAkc3RhdGUuJGN1cnJlbnQuc2VsZi5uYW1lO1xuICAgICAgICB2bS5zZWN0aW9ucyA9IFNlY3Rpb25zLnNlY3Rpb25zO1xuICAgIH1cblxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAubW9kdWxlKCdlYXRDaGFsbGVuZ2VBcHAnKVxuICAgICAgLmNvbnRyb2xsZXIoJ3NpZ251cENvbnRyb2xsZXInLCBzaWdudXBDb250cm9sbGVyKTtcbiAgICBzaWdudXBDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICdhdXRoJywgJ1NlY3Rpb25zJ107XG5cbiAgICBmdW5jdGlvbiBzaWdudXBDb250cm9sbGVyKCRzY29wZSwgYXV0aCwgU2VjdGlvbnMpIHtcbiAgICAgICAgdmFyIHZtID0gJHNjb3BlO1xuICAgICAgICB2YXIgdXNlciA9IHt9O1xuICAgICAgICB2bS5zdWJtaXQgPSBzdWJtaXQ7XG4gICAgICAgIHZtLnVzZXIgPSB1c2VyO1xuXG4gICAgICAgIGZ1bmN0aW9uIHN1Ym1pdCgpIHtcbiAgICAgICAgICAgIHZtLmVycm9yID0gZmFsc2U7XG4gICAgICAgICAgICAvLyBUT0RPOiBhZGQgbG9hZGluZyBpY29uIHRvIFVJIHdoZW4gZGlzYWJsZWQgPT09IHRydWVcbiAgICAgICAgICAgIHZtLmRpc2FibGVkID0gdHJ1ZTtcblxuICAgICAgICAgICAgYXV0aC5zaWdudXAodXNlci5lbWFpbCwgdXNlci5wYXNzd29yZClcbiAgICAgICAgICAgIC50aGVuKHN1Y2Nlc3NIYW5kbGVyLCBlcnJvckhhbmRsZXIpO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBzdWNjZXNzSGFuZGxlcigpIHtcbiAgICAgICAgICAgICAgICB2bS5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHZtLnNpZ251cEZvcm0gPSB7fTsgLy9SZXNldCBmb3JtXG4gICAgICAgICAgICAgICAgdm0ubWVzc2FnZSA9ICdzdWNjZXNzZnVsbHkgY3JlYXRlZCBhbiBhY2NvdW50JztcbiAgICAgICAgICAgICAgICBTZWN0aW9ucy5nb0JhY2soKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZXJyb3JIYW5kbGVyKGVycikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgICAgICAgdm0uZXJyb3IgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSAnU29tZXRoaW5nIHdlbnQgd3JvbmcuIFBsZWFzZSB0cnkgYWdhaW4nO1xuICAgICAgICAgICAgICAgIHZtLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgLy8gdm0uc2lnbnVwRm9ybSA9IHt9XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2VhdENoYWxsZW5nZUFwcCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdzb0ZhckNvbnRyb2xsZXInLCBzb0ZhckNvbnRyb2xsZXIpO1xuXG4gICAgc29GYXJDb250cm9sbGVyLiRpbmplY3QgPSBbXG4gICAgICAgICckaHR0cCcsXG4gICAgICAgICckaW50ZXJ2YWwnLFxuICAgICAgICAnJG1kRGlhbG9nJyxcbiAgICAgICAgJyRtZE1lZGlhJyxcbiAgICAgICAgJyRyb290U2NvcGUnLFxuICAgICAgICAnJHNjb3BlJyxcbiAgICAgICAgJyRzdGF0ZScsXG4gICAgICAgICdIb3VzZWhvbGQnLFxuICAgICAgICAnU2VjdGlvbnMnXG4gICAgXTtcblxuICAgIGZ1bmN0aW9uIHNvRmFyQ29udHJvbGxlciAoJGh0dHAsICRpbnRlcnZhbCwgJG1kRGlhbG9nLCAkbWRNZWRpYSwgJHJvb3RTY29wZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLCAkc3RhdGUsIEhvdXNlaG9sZCwgU2VjdGlvbnMpIHtcbiAgICAgICAgLyoganNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xuICAgICAgICB2YXIgdm0gPSAkc2NvcGU7XG4gICAgICAgIHZtLm1lYW5zVGVzdCA9IFNlY3Rpb25zLm1lYW5zVGVzdDtcblxuICAgICAgICB2bS5jaGlsZHJlbkxhYmVsID0gJ2NoaWxkcmVuJztcbiAgICAgICAgdm0uYWR1bHRzTGFiZWwgPSAnYWR1bHRzJztcblxuICAgICAgICB2bS5pbmNvbWVFYXJuZXJzQ291bnQgPSBjb3VudEVhcm5lcnMoJHJvb3RTY29wZS5ob3VzZWhvbGQpO1xuICAgICAgICB2bS5pbmNvbWVFc3RpbWF0ZSA9IGVzdGltYXRlSW5jb21lKCRyb290U2NvcGUuaG91c2Vob2xkKTtcblxuICAgICAgICAvLyBuYXZpZ2F0aW9uXG4gICAgICAgIHZtLmdvQmFjayA9IGdvQmFjaztcbiAgICAgICAgdm0ubmF2aWdhdGVUb05leHRTZWN0aW9uID0gbmF2aWdhdGVUb05leHRTZWN0aW9uO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICAgICAgaWYgKCRyb290U2NvcGUuaG91c2Vob2xkLmNoaWxkcmVuLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgIHZtLmNoaWxkcmVuTGFiZWwgPSAnY2hpbGQnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCRyb290U2NvcGUuaG91c2Vob2xkLm90aGVyTWVtYmVycy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICB2bS5hZHVsdHNMYWJlbCA9ICdhZHVsdCc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpbml0KCk7XG5cbiAgICAgICAgZnVuY3Rpb24gZXN0aW1hdGVJbmNvbWUoKSB7XG4gICAgICAgICAgICB2YXIgZnJlcXVlbmN5TXVsaXRwbGllciA9IHtcbiAgICAgICAgICAgICAgICB3ZWVrbHk6IDUyLFxuICAgICAgICAgICAgICAgICdldmVyeSAyIHdlZWtzJzogMjYsXG4gICAgICAgICAgICAgICAgJ3R3aWNlIGEgbW9udGgnOiAyNCxcbiAgICAgICAgICAgICAgICBtb250aGx5OiAxMlxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0VG90YWxmb3JTb3VyY2Uoc291cmNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNvdXJjZS5hbW91bnQgKiBmcmVxdWVuY3lNdWxpdHBsaWVyW3NvdXJjZS5mcmVxdWVuY3ldO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgZXN0aW1hdGVkQW5udWFsSW5jb21lID0gMDtcblxuICAgICAgICAgICAgJHJvb3RTY29wZS5ob3VzZWhvbGQuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbihjaGlsZCkge1xuICAgICAgICAgICAgICAgIGlmIChjaGlsZC5lYXJuc0luY29tZSkge1xuICAgICAgICAgICAgICAgICAgICBjaGlsZC5pbmNvbWVTb3VyY2VzLmZvckVhY2goZnVuY3Rpb24oaW5jb21lU291cmNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5jb21lU291cmNlLmFtb3VudCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlc3RpbWF0ZWRBbm51YWxJbmNvbWUgKz0gZ2V0VG90YWxmb3JTb3VyY2UoaW5jb21lU291cmNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICRyb290U2NvcGUuaG91c2Vob2xkLm90aGVyTWVtYmVycy5mb3JFYWNoKGZ1bmN0aW9uKG1lbWJlcikge1xuICAgICAgICAgICAgICAgIGlmICghbWVtYmVyLmluY29tZUNhdGVnb3J5KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIGluY29tZVNvdXJjZTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gbWVtYmVyLmluY29tZUNhdGVnb3J5KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgdmFsdWUgZ2V0cyBzdGFzaGVkIGluIHRoZSBzYW1lIHBsYWNlXG4gICAgICAgICAgICAgICAgICAgIGluY29tZVNvdXJjZSA9IG1lbWJlci5pbmNvbWVDYXRlZ29yeVtrZXldO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBrIGluIGluY29tZVNvdXJjZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGsgIT09ICdzaG93Q2hlY2tib3hlcycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc291cmNlID0gaW5jb21lU291cmNlW2tdO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXN0aW1hdGVkQW5udWFsSW5jb21lICs9IGdldFRvdGFsZm9yU291cmNlKHNvdXJjZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBNYXRoLnJvdW5kKGVzdGltYXRlZEFubnVhbEluY29tZSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBjb3VudEVhcm5lcnMoaG91c2Vob2xkKSB7XG4gICAgICAgICAgICB2YXIgZWFybmVyc0NvdW50ID0gMDtcbiAgICAgICAgICAgICRyb290U2NvcGUuaG91c2Vob2xkLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oY2hpbGQpIHtcbiAgICAgICAgICAgICAgICBpZiAoY2hpbGQuZWFybnNJbmNvbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgZWFybmVyc0NvdW50Kys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICRyb290U2NvcGUuaG91c2Vob2xkLm90aGVyTWVtYmVycy5mb3JFYWNoKGZ1bmN0aW9uKG1lbWJlcikge1xuICAgICAgICAgICAgICAgIGlmIChtZW1iZXIuaW5jb21lQ2F0ZWdvcnkgJiYgT2JqZWN0LmtleXMobWVtYmVyLmluY29tZUNhdGVnb3J5KS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGVhcm5lcnNDb3VudCsrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZWFybmVyc0NvdW50O1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ29CYWNrKCkge1xuICAgICAgICAgICAgSG91c2Vob2xkLnNhdmUoKTtcbiAgICAgICAgICAgIFNlY3Rpb25zLnVwZGF0ZVJlcXVpcmVkU2VjdGlvbnMoKTtcbiAgICAgICAgICAgIFNlY3Rpb25zLmdvQmFjaygpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gbmF2aWdhdGVUb05leHRTZWN0aW9uKCkge1xuICAgICAgICAgICAgSG91c2Vob2xkLnNhdmUoKTtcbiAgICAgICAgICAgIFNlY3Rpb25zLnVwZGF0ZVJlcXVpcmVkU2VjdGlvbnMoKTtcbiAgICAgICAgICAgIFNlY3Rpb25zLm5hdmlnYXRlVG9OZXh0KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgLm1vZHVsZSgnZWF0Q2hhbGxlbmdlQXBwJylcbiAgICAgIC5jb250cm9sbGVyKCd1c2VyQ29udHJvbHNDb250cm9sbGVyJywgdXNlckNvbnRyb2xzQ29udHJvbGxlcik7XG4gICAgdXNlckNvbnRyb2xzQ29udHJvbGxlci4kaW5qZWN0ID0gWyckcm9vdFNjb3BlJywgJyRzY29wZScsICckc3RhdGUnLCAnYXV0aCddO1xuICAgIGZ1bmN0aW9uIHVzZXJDb250cm9sc0NvbnRyb2xsZXIoJHJvb3RTY29wZSwgJHNjb3BlLCAkc3RhdGUsIGF1dGgpIHtcbiAgICAgICAgdmFyIHZtID0gJHNjb3BlO1xuICAgICAgICB2bS5sb2dnZWRJbiA9IGF1dGguZ2V0VXNlclN0YXR1cygpO1xuICAgICAgICB2bS5sb2dvdXQgPSBsb2dvdXQ7XG4gICAgICAgIHZtLnVzZXIgPSAkcm9vdFNjb3BlLnVzZXI7XG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAgICAgZnVuY3Rpb24gbG9nb3V0KCkge1xuICAgICAgICAgICAgYXV0aC5sb2dvdXQoKTtcbiAgICAgICAgICAgIHZtLmxvZ2dlZEluID0gYXV0aC5nZXRVc2VyU3RhdHVzKCk7XG4gICAgICAgICAgICAkc3RhdGUuZ28oJ3NhdmVBbmRFeGl0Jyk7XG4gICAgICAgIH1cblxuICAgICAgICAkcm9vdFNjb3BlLiR3YXRjaCgndXNlcicsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdm0ubG9nZ2VkSW4gPSBhdXRoLmdldFVzZXJTdGF0dXMoKTtcbiAgICAgICAgICAgIHZtLnVzZXIgPSAkcm9vdFNjb3BlLnVzZXI7XG4gICAgICAgIH0pO1xuICAgIH1cblxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2VhdENoYWxsZW5nZUFwcCcpXG4gICAgICAgIC5zZXJ2aWNlKCdhdXRoJywgQXV0aFNlcnZpY2UpO1xuXG4gICAgQXV0aFNlcnZpY2UuJGluamVjdCA9IFsnJGNvb2tpZXMnLCAnJGh0dHAnLCAnJHEnLCAnJHJvb3RTY29wZScsICckc3RhdGUnLCAnSG91c2Vob2xkJ107XG5cbiAgICBmdW5jdGlvbiBBdXRoU2VydmljZSgkY29va2llcywgJGh0dHAsICRxLCAkcm9vdFNjb3BlLCAkc3RhdGUsIEhvdXNlaG9sZCkge1xuICAgICAgICAkcm9vdFNjb3BlLnVzZXIgPSBudWxsO1xuICAgICAgICBpbml0KCk7XG4gICAgICAgIHZhciBzZXJ2aWNlID0ge307XG4gICAgICAgIHNlcnZpY2UuaXNMb2dnZWRJbiA9IGlzTG9nZ2VkSW47XG4gICAgICAgIHNlcnZpY2UuZ2V0VXNlclN0YXR1cyA9IGdldFVzZXJTdGF0dXM7XG4gICAgICAgIHNlcnZpY2Uuc2lnbnVwID0gc2lnbnVwO1xuICAgICAgICBzZXJ2aWNlLmxvZ2luID0gbG9naW47XG4gICAgICAgIHNlcnZpY2UubG9nb3V0ID0gbG9nb3V0O1xuICAgICAgICBzZXJ2aWNlLmluaXQgPSBpbml0O1xuXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgICAgIC8vIENoZWNrIGZvciB1c2VyIG9uIHN0YXJ0XG4gICAgICAgICAgICB2YXIgdXNlciA9IGdldENyZWRlbnRpYWxzKCk7XG4gICAgICAgICAgICBpZiAodXNlcikge1xuICAgICAgICAgICAgICAgICRyb290U2NvcGUudXNlciA9IHVzZXI7XG4gICAgICAgICAgICAgICAgSG91c2Vob2xkLnJldHJpZXZlRm9yVXNlcih1c2VyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaXNMb2dnZWRJbigpIHtcbiAgICAgICAgICAgIGlmICgkcm9vdFNjb3BlLnVzZXIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldFVzZXJTdGF0dXMoKSB7XG4gICAgICAgICAgICByZXR1cm4gJHJvb3RTY29wZS51c2VyO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc2lnbnVwKGVtYWlsLCBwYXNzd29yZCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwXG4gICAgICAgICAgICAgICAgLnBvc3QoJy91c2VyL3NpZ251cCcsIHt1c2VybmFtZTogZW1haWwsIHBhc3N3b3JkOiBwYXNzd29yZH0pXG4gICAgICAgICAgICAgICAgLnRoZW4oc3VjY2Vzc0hhbmRsZXIsIGVycm9ySGFuZGxlcik7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHN1Y2Nlc3NIYW5kbGVyKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgc2V0Q3JlZGVudGlhbHMocmVzcG9uc2UuZGF0YS51c2VyKTtcbiAgICAgICAgICAgICAgICBIb3VzZWhvbGQuc2F2ZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBlcnJvckhhbmRsZXIoZXJyKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGxvZ2luKGVtYWlsLCBwYXNzd29yZCkge1xuICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6IGVtYWlsLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcmV0dXJuICRodHRwXG4gICAgICAgICAgICAgICAgLnBvc3QoJy91c2VyL2xvZ2luJywgZGF0YSlcbiAgICAgICAgICAgICAgICAudGhlbihzdWNjZXNzSGFuZGxlciwgZXJyb3JIYW5kbGVyKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gc3VjY2Vzc0hhbmRsZXIocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBzZXRDcmVkZW50aWFscyhyZXNwb25zZS5kYXRhLnVzZXIpO1xuICAgICAgICAgICAgICAgIEhvdXNlaG9sZC5yZXRyaWV2ZUZvclVzZXIocmVzcG9uc2UuZGF0YS51c2VyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZXJyb3JIYW5kbGVyKHJlc3BvbnNlLCBlcnIpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgICAgIGNsZWFyQ3JlZGVudGlhbHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGxvZ291dCgpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cFxuICAgICAgICAgICAgICAgIC5nZXQoJ3VzZXIvbG9nb3V0JylcbiAgICAgICAgICAgICAgICAudGhlbihzdWNjZXNzSGFuZGxlciwgZXJyb3JIYW5kbGVyKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gc3VjY2Vzc0hhbmRsZXIoKSB7XG4gICAgICAgICAgICAgICAgY2xlYXJDcmVkZW50aWFscygpO1xuICAgICAgICAgICAgICAgIEhvdXNlaG9sZC5jbGVhcigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBlcnJvckhhbmRsZXIoKSB7XG4gICAgICAgICAgICAgICAgY2xlYXJDcmVkZW50aWFscygpO1xuICAgICAgICAgICAgICAgIEhvdXNlaG9sZC5jbGVhcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc2V0Q3JlZGVudGlhbHModXNlcikge1xuICAgICAgICAgICAgJHJvb3RTY29wZS51c2VyID0gdXNlcjtcbiAgICAgICAgICAgIHJldHVybiAkY29va2llcy5wdXRPYmplY3QoJ3VzZXInLCB1c2VyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldENyZWRlbnRpYWxzKCkge1xuICAgICAgICAgICAgcmV0dXJuICRjb29raWVzLmdldE9iamVjdCgndXNlcicpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY2xlYXJDcmVkZW50aWFscygpIHtcbiAgICAgICAgICAgICRyb290U2NvcGUudXNlciA9IG51bGw7XG4gICAgICAgICAgICByZXR1cm4gJGNvb2tpZXMucmVtb3ZlKCd1c2VyJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdlYXRDaGFsbGVuZ2VBcHAnKVxuICAgICAgICAuc2VydmljZSgnSG91c2Vob2xkJywgaG91c2Vob2xkU2VydmljZSk7XG5cbiAgICBob3VzZWhvbGRTZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywgJyRyb290U2NvcGUnXTtcblxuICAgIGZ1bmN0aW9uIGhvdXNlaG9sZFNlcnZpY2UoJGh0dHAsICRyb290U2NvcGUpIHtcbiAgICAgICAgLy8gVG9kbzogY29uc2lkZXIgbW92aW5nIHRvIHNlcnZlcj8/XG4gICAgICAgIHZhciBIb3VzZWhvbGQgPSAge1xuICAgICAgICAgICAgY2hpbGRDb3VudDogbnVsbCxcbiAgICAgICAgICAgIGNoaWxkcmVuOiBbXSxcbiAgICAgICAgICAgIG90aGVyTWVtYmVyc0NvdW50OiBudWxsLFxuICAgICAgICAgICAgb3RoZXJNZW1iZXJzOiBbXSxcbiAgICAgICAgICAgIGNvbXBsZXRlZEFwcGxpY2F0aW9uOiBmYWxzZVxuICAgICAgICB9O1xuXG4gICAgICAgICRyb290U2NvcGUuaG91c2Vob2xkID0gYW5ndWxhci5jb3B5KEhvdXNlaG9sZCk7XG5cbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7fTtcbiAgICAgICAgc2VydmljZS5yZXRyaWV2ZUZvclVzZXIgPSByZXRyaWV2ZUZvclVzZXI7XG4gICAgICAgIHNlcnZpY2Uuc2F2ZSA9IHNhdmU7XG4gICAgICAgIHNlcnZpY2UuY2xlYXIgPSBjbGVhcjtcbiAgICAgICAgc2VydmljZS5zdWJtaXQgPSBzdWJtaXQ7XG5cbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiByZXRyaWV2ZUZvclVzZXIodXNlcikge1xuICAgICAgICAgICAgJGh0dHAuZ2V0KCcvaG91c2Vob2xkLycgKyB1c2VyLl9pZClcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmhvdXNlaG9sZCA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzYXZlKCkge1xuICAgICAgICAgICAgLy8gT25seSBzYXZlIG9uIHRoZSBsYXN0IHBhZ2Ugb3Igd2hlbiBcbiAgICAgICAgICAgIC8vIHRoZXJlJ3MgYSBzaWduZWQgaW4gdXNlclxuICAgICAgICAgICAgaWYgKCEkcm9vdFNjb3BlLnVzZXIpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZGlkIG5vdCBuZWVkIHRvIHNhdmUnKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRyb290U2NvcGUuaG91c2Vob2xkLnVzZXJJZCA9ICRyb290U2NvcGUudXNlci5faWQ7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnYmVmb3JlJylcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCRyb290U2NvcGUuaG91c2Vob2xkKTtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvaG91c2Vob2xkJywgJHJvb3RTY29wZS5ob3VzZWhvbGQpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY29taW5nIGJhY2snKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5ob3VzZWhvbGQgPSByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHN1Ym1pdCgpIHtcbiAgICAgICAgICAgIGlmICgkcm9vdFNjb3BlLnVzZXIpIHtcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmhvdXNlaG9sZC51c2VySWQgPSAkcm9vdFNjb3BlLnVzZXIuX2lkO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2hvdXNlaG9sZCcsICRyb290U2NvcGUuaG91c2Vob2xkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGNsZWFyICgpIHtcbiAgICAgICAgICAgICRyb290U2NvcGUuaG91c2Vob2xkID0gT2JqZWN0LmNyZWF0ZShIb3VzZWhvbGQpO1xuICAgICAgICB9XG4gICAgfVxuXG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnZWF0Q2hhbGxlbmdlQXBwJylcbiAgICAgICAgLnNlcnZpY2UoJ1NlY3Rpb25zJywgc2VjdGlvbnNTZXJ2aWNlKTtcblxuICAgIHNlY3Rpb25zU2VydmljZS4kaW5qZWN0ID0gWyckcm9vdFNjb3BlJyAsJyRzdGF0ZSddO1xuXG4gICAgZnVuY3Rpb24gc2VjdGlvbnNTZXJ2aWNlKCRyb290U2NvcGUsICRzdGF0ZSkge1xuICAgICAgICB2YXIgc2VjdGlvbnMgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbGFiZWw6ICdMZXRcXOKAmXMgR2V0IFN0YXJ0ZWQhICcsXG4gICAgICAgICAgICAgICAgc3RhdGU6ICdzdGFydCcsXG4gICAgICAgICAgICAgICAgY29tcGxldGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBzaG93U3VtbWFyeUFmdGVyOiBmYWxzZVxuICAgICAgICAgICAgfSwgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbGFiZWw6ICdDaGlsZHJlbicsXG4gICAgICAgICAgICAgICAgc3RhdGU6ICdjaGlsZHJlbicsXG4gICAgICAgICAgICAgICAgY29tcGxldGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBzaG93U3VtbWFyeUFmdGVyOiBmYWxzZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBsYWJlbDogJ0hvdXNlaG9sZCBNZW1iZXJzJyxcbiAgICAgICAgICAgICAgICBzdGF0ZTogJ2hvdXNlaG9sZCcsXG4gICAgICAgICAgICAgICAgY29tcGxldGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBzaG93U3VtbWFyeUFmdGVyOiBmYWxzZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBsYWJlbDogJ1doYXQgWW91XFwndmUgRW50ZXJlZCBTbyBGYXInLFxuICAgICAgICAgICAgICAgIHN0YXRlOiAnc29GYXInLFxuICAgICAgICAgICAgICAgIGNvbXBsZXRlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgc2hvd1N1bW1hcnlBZnRlcjogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbGFiZWw6ICdDaGlsZHJlblxcJ3MgSW5jb21lJyxcbiAgICAgICAgICAgICAgICBzdGF0ZTogJ2NoaWxkSW5jb21lJyxcbiAgICAgICAgICAgICAgICBjb21wbGV0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIHNob3dTdW1tYXJ5QWZ0ZXI6IGZhbHNlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGxhYmVsOiAnSG91c2Vob2xkIEluY29tZScsXG4gICAgICAgICAgICAgICAgc3RhdGU6ICdob3VzZWhvbGRJbmNvbWUnLFxuICAgICAgICAgICAgICAgIGNvbXBsZXRlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgc2hvd1N1bW1hcnlBZnRlcjogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbGFiZWw6ICdTdW1tYXJ5JyxcbiAgICAgICAgICAgICAgICBzdGF0ZTogJ3NvRmFyLTInLFxuICAgICAgICAgICAgICAgIGNvbXBsZXRlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgc2hvd1N1bW1hcnlBZnRlcjogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbGFiZWw6ICdEaXNjbG9zdXJlJyxcbiAgICAgICAgICAgICAgICBzdGF0ZTogJ2Rpc2Nsb3N1cmUnLFxuICAgICAgICAgICAgICAgIGNvbXBsZXRlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgc2hvd1N1bW1hcnlBZnRlcjogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbGFiZWw6ICdTaWduIGFuZCBDb25maXJtJyxcbiAgICAgICAgICAgICAgICBzdGF0ZTogJ3NpZ25hdHVyZScsXG4gICAgICAgICAgICAgICAgY29tcGxldGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBzaG93U3VtbWFyeUFmdGVyOiBmYWxzZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgXTtcblxuICAgICAgICB2YXIgaW5kZXhlZFNlY3Rpb25zID0gXy5pbmRleEJ5KHNlY3Rpb25zLCAnc3RhdGUnKTtcblxuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIG1lYW5zVGVzdDogdHJ1ZSxcbiAgICAgICAgICAgIHNlY3Rpb25zOiBzZWN0aW9ucyxcbiAgICAgICAgICAgIGluZGV4ZWRTZWN0aW9uczogaW5kZXhlZFNlY3Rpb25zLFxuICAgICAgICAgICAgbmF2aWdhdGVUb05leHQ6IG5hdmlnYXRlVG9OZXh0LFxuICAgICAgICAgICAgZ29CYWNrOiBnb0JhY2ssXG4gICAgICAgICAgICB1cGRhdGVSZXF1aXJlZFNlY3Rpb25zOiB1cGRhdGVSZXF1aXJlZFNlY3Rpb25zXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiB1cGRhdGVSZXF1aXJlZFNlY3Rpb25zKCkge1xuICAgICAgICAgICAgdmFyIGhvdXNlaG9sZCA9ICRyb290U2NvcGUuaG91c2Vob2xkO1xuICAgICAgICAgICAgc2VydmljZS5tZWFuc1Rlc3QgPSB0cnVlO1xuICAgICAgICAgICAgdmFyIGFzc2lzdGFuY2VQcm9ncmFtSG91c2Vob2xkID0gaXNBc3Npc3RhbmNlSG91c2Vob2xkKGhvdXNlaG9sZCk7XG4gICAgICAgICAgICB2YXIgY2F0ZWdvcmljYWxseVF1YWxpZmllZCA9IGFsbFN0dWRlbnRzQ2F0ZWdvcmljYWxseVF1YWxpZnkoaG91c2Vob2xkKTtcblxuICAgICAgICAgICAgaWYgKGFzc2lzdGFuY2VQcm9ncmFtSG91c2Vob2xkIHx8IGNhdGVnb3JpY2FsbHlRdWFsaWZpZWQpIHtcbiAgICAgICAgICAgICAgICBzZXJ2aWNlLm1lYW5zVGVzdCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGluZGV4ZWRTZWN0aW9uc1snY2hpbGRJbmNvbWUnXS5yZXF1aXJlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGluZGV4ZWRTZWN0aW9uc1snaG91c2Vob2xkJ10ucmVxdWlyZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBpbmRleGVkU2VjdGlvbnNbJ2hvdXNlaG9sZEluY29tZSddLnJlcXVpcmVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgaW5kZXhlZFNlY3Rpb25zWydzb0Zhci0yJ10ucmVxdWlyZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNlY3Rpb25zLmZvckVhY2goZnVuY3Rpb24oc2VjdGlvbikge1xuICAgICAgICAgICAgICAgIHNlY3Rpb24ucmVxdWlyZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBpc0Fzc2lzdGFuY2VIb3VzZWhvbGQoaG91c2Vob2xkKSB7XG4gICAgICAgICAgICB2YXIgY3VycmVudENoaWxkO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAgOyBpIDwgaG91c2Vob2xkLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudENoaWxkID0gaG91c2Vob2xkLmNoaWxkcmVuW2ldO1xuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Q2hpbGQuYXNzaXN0YW5jZVByb2dyYW0gJiYgY3VycmVudENoaWxkLmFzc2lzdGFuY2VQcm9ncmFtLnBhcnRpY2lwYW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGFsbFN0dWRlbnRzQ2F0ZWdvcmljYWxseVF1YWxpZnkoaG91c2Vob2xkKSB7XG4gICAgICAgICAgICB2YXIgY3VycmVudENoaWxkLCBjaGlsZFF1YWxpZmllcztcblxuICAgICAgICAgICAgdmFyIGVucm9sbGVkQ2hpbGRyZW4gPSBfLmZpbHRlcihob3VzZWhvbGQuY2hpbGRyZW4sIGZ1bmN0aW9uKGMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYy5lbnJvbGxlZCA9PT0gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBtdXN0IGhhdmUga2lkcyB0byBxdWFsaWZ5XG4gICAgICAgICAgICBpZiAoZW5yb2xsZWRDaGlsZHJlbi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vYWxsIGNoaWxkcmVuIGFyZSBjYXRlZ29yaWNhbGx5IHF1YWxpZmllZFxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAgOyBpIDwgZW5yb2xsZWRDaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRDaGlsZCA9IGhvdXNlaG9sZC5jaGlsZHJlbltpXTtcbiAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRDaGlsZC5zcGVjaWFsU3RhdHVzLmZvc3RlckNoaWxkICYmXG4gICAgICAgICAgICAgICAgICAgICFjdXJyZW50Q2hpbGQuc3BlY2lhbFN0YXR1cy5ob21lbGVzc01pZ3JhbnRSdW5hd2F5ICYmXG4gICAgICAgICAgICAgICAgICAgICFjdXJyZW50Q2hpbGQuc3BlY2lhbFN0YXR1cy5oZWFkU3RhcnRQYXJ0aWNpcGFudFxuICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZmluZE5leHQoY3VycmVudFN0YXRlKSB7XG4gICAgICAgICAgICB2YXIgY3VycmVudEluZGV4ID0gXy5maW5kSW5kZXgoc2VjdGlvbnMsIGZ1bmN0aW9uKHNlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2VjdGlvbi5zdGF0ZSA9PT0gY3VycmVudFN0YXRlO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIExvb2sgZm9yIHRoZSBuZXh0IHJlcXVpcmVkIHNlY3Rpb25cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSBjdXJyZW50SW5kZXggKyAxOyBpIDwgc2VjdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoc2VjdGlvbnNbaV0ucmVxdWlyZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlY3Rpb25zW2ldLnN0YXRlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gaWYgdGhlcmUgYXJlIG5vIG1vcmUgcmVxdWlyZWQgc2VjdGlvbnMsIHdlJ3JlIGRvbmUuXG4gICAgICAgICAgICByZXR1cm4gJ2NvbmZpcm1hdGlvbic7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBuYXZpZ2F0ZVRvTmV4dCgpIHtcbiAgICAgICAgICAgIHZhciBuZXh0U2VjdGlvbjtcbiAgICAgICAgICAgIHZhciBjdXJyZW50U3RhdGUgPSAkcm9vdFNjb3BlLmN1cnJlbnRTdGF0ZSB8fCAkc3RhdGUuJGN1cnJlbnQuc2VsZi5uYW1lO1xuICAgICAgICAgICAgdmFyIHByZXZpb3VzU3RhdGUgPSAkcm9vdFNjb3BlLnByZXZpb3VzU3RhdGUgfHwgJ3N0YXJ0JztcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBJZiB5b3UncmUgb24gc29tZSBvdGhlciBwYWdlIGxpa2Ugc3RhcnQgb3Igc2lnbmF0dXJlXG4gICAgICAgICAgICAvLyBNb3ZlIGFoZWFkIGFzIG5vcm1hbFxuICAgICAgICAgICAgbmV4dFNlY3Rpb24gID0gZmluZE5leHQoY3VycmVudFN0YXRlKTtcblxuXG4gICAgICAgICAgICAkc3RhdGUuZ28obmV4dFNlY3Rpb24pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ29CYWNrKCkge1xuICAgICAgICAgICAgdmFyIHByZXZpb3VzU3RhdGUgPSAnc3RhcnQnO1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRTdGF0ZSA9ICRyb290U2NvcGUuY3VycmVudFN0YXRlO1xuICAgICAgICAgICAgdmFyIG91dE9mRmxvd1N0YXRlcyA9IFsnbG9naW4nLCAnc2lnbnVwJ107XG5cbiAgICAgICAgICAgIGlmIChvdXRPZkZsb3dTdGF0ZXMuaW5kZXhPZihjdXJyZW50U3RhdGUpICE9PSAtMSkge1xuICAgICAgICAgICAgICAgIHByZXZpb3VzU3RhdGUgPSAkcm9vdFNjb3BlLnByZXZpb3VzU3RhdGUgfHwgJ3N0YXJ0JztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRJbmRleCA9IF8uZmluZEluZGV4KHNlY3Rpb25zLCBmdW5jdGlvbihzZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWN0aW9uLnN0YXRlID09PSBjdXJyZW50U3RhdGU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcHJldmlvdXNTdGF0ZSA9IHNlY3Rpb25zW2N1cnJlbnRJbmRleCAtIDFdLnN0YXRlO1xuICAgICAgICAgICAgICAgIHdoaWxlIChpbmRleGVkU2VjdGlvbnNbcHJldmlvdXNTdGF0ZV0ucmVxdWlyZWQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRJbmRleCA9IGN1cnJlbnRJbmRleCAtIDE7XG4gICAgICAgICAgICAgICAgICAgIHByZXZpb3VzU3RhdGUgPSBzZWN0aW9uc1tjdXJyZW50SW5kZXggLSAxXS5zdGF0ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICRzdGF0ZS5nbyhwcmV2aW91c1N0YXRlKTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG59KSgpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
